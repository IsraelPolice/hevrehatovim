<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>מלחמת העולם - המשחק העתידני</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Rubik', sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #0d1b2a, #1b263b, #415a77);
            color: #e0e1dd;
            direction: rtl;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
            animation: glowBackground 5s infinite alternate;
        }

        @keyframes glowBackground {
            0% { background: linear-gradient(135deg, #0d1b2a, #1b263b, #415a77); }
            100% { background: linear-gradient(135deg, #1b263b, #415a77, #778da9); }
        }

        h1, h2 {
            color: #00ffcc;
            text-shadow: 0 0 10px #00ffcc, 0 0 20px #00ffcc;
            font-size: 2.5em;
        }

        .character-card {
            display: inline-block;
            margin: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #00ffcc;
            border-radius: 15px;
            box-shadow: 0 0 15px #00ffcc;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            width: 200px;
            text-align: center;
        }

        .character-card:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px #ff0066;
        }

        .character-card.selected {
            border-color: #ff0066;
            box-shadow: 0 0 20px #ff0066;
        }

        .character-card img {
            border-radius: 10px;
            width: 120px;
            height: 120px;
            object-fit: cover;
        }

        .team-card {
            display: inline-block;
            margin: 20px;
            padding: 20px;
            width: 220px;
            height: 350px;
            background: linear-gradient(135deg, rgba(0, 255, 204, 0.2), rgba(255, 0, 102, 0.2));
            border: 2px solid #ff0066;
            border-radius: 15px;
            box-shadow: 0 0 20px #ff0066;
            position: relative;
            animation: revealCard 1.5s ease forwards;
        }

        @keyframes revealCard {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .team-card img.player-img {
            width: 130px;
            height: 130px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid #00ffcc;
        }

        .team-card .name { font-size: 22px; color: #00ffcc; text-shadow: 0 0 5px #00ffcc; }
        .team-card .overall { font-size: 20px; color: #e0e1dd; }
        .team-card .stars { font-size: 18px; color: #ff0066; }
        .team-card .flag { position: absolute; top: 10px; right: 10px; width: 40px; }

        button {
            padding: 12px 25px;
            font-size: 18px;
            background: #ff0066;
            color: #e0e1dd;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 0 10px #ff0066;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px #ff0066;
        }

        button:disabled {
            background: #555;
            box-shadow: none;
            cursor: not-allowed;
        }

        select {
            padding: 8px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: #e0e1dd;
            border: 1px solid #00ffcc;
            border-radius: 5px;
        }

        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1b263b, #415a77);
            border: 2px solid #ff0066;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 30px #ff0066;
            z-index: 1000;
            text-align: center;
            animation: popupGlow 2s infinite alternate;
        }

        @keyframes popupGlow {
            0% { box-shadow: 0 0 30px #ff0066; }
            100% { box-shadow: 0 0 50px #00ffcc; }
        }

        .popup img {
            width: 120px;
            height: 120px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <h1>מלחמת העולם העתידנית</h1>
    <div id="character-selection"></div>
    <button id="confirm-team" disabled>אשר צוות</button>
    <div id="team-display" style="display: none;"></div>
    <div id="battle-display" style="display: none;"></div>

    <script>
        const characters = [
            { name: "אור דהן", overall: 79, image: "https://i.postimg.cc/13r31pJG/IMG-5054.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "יוסף קחלר", overall: 88, image: "https://i.postimg.cc/KYcvGRHd/IMG-4721-2.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Flag_of_Iraq.svg/1200px-Flag_of_Iraq.svg.png" },
            { name: "עמית לסרי", overall: 90, image: "https://i.postimg.cc/Y2T962vW/IMG-5056.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "איציק מור יוסף", overall: 82, image: "https://i.postimg.cc/SQnRYYx4/IMG-5057.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "איתי אוחנה", overall: 90, image: "https://i.postimg.cc/DwTwNCdf/IMG-5058.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "ג׳ורדן בוחבוט", overall: 86, image: "https://i.postimg.cc/zvbsDr5m/IMG-5059.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "דביר אוחנה", overall: 92, image: "https://i.postimg.cc/J0f9G24s/IMG-5060.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "דור אביכזר", overall: 80, image: "https://i.postimg.cc/vBNRdmJL/IMG-5061.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "יוגב שבתאי", overall: 74, image: "https://i.postimg.cc/TYmPC8bH/IMG-5062.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "ליאב בן יעקב", overall: 83, image: "https://i.postimg.cc/Sss059vx/IMG-5063.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "אריאל עין גל", overall: 58, image: "https://i.postimg.cc/k5w3fsw-H/IMG-5064.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "מיכה גורלובסקי", overall: 85, image: "https://i.postimg.cc/jjRYHm6N/IMG-5065.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "קורן בן משה", overall: 89, image: "https://i.postimg.cc/wjXdsgNg/IMG-5066.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "נתנאל יוסילביץ׳", overall: 82, image: "https://i.postimg.cc/wMndDBFT/IMG-5068.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "חיים מרקס", overall: 66, image: "https://i.postimg.cc/MHnScB7F/IMG-5069.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Flag_of_the_United_States.svg/1200px-Flag_of_the_United_States.svg.png" },
            { name: "רפי אלגרבלי", overall: 71, image: "https://i.postimg.cc/9MFVhKrV/IMG-5070.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Flag_of_Palestine.svg/1200px-Flag_of_Palestine.svg.png" },
            { name: "יעקב שוורץ", overall: 88, image: "https://i.postimg.cc/nzRxc2Dm/IMG-5071.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "אריאל שרביט", overall: 57, image: "https://i.postimg.cc/TPcGBf2C/IMG-5072.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" },
            { name: "דביר ברקת", overall: 96, image: "https://www.qube.co.il/images/ency/bands/DvirBareket.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png" }
        ];

        const weapons = [
            { name: "M16", image: "https://i.namu.wiki/i/xDo8hsJkfCKFSp-yzjin3gVH021GKsEIU0YnkAuQDKs-crFCCHZ6VnRqt8koRbEa5Ex7JJkq-6TwKli9AR4slw.webp" },
            { name: "M4", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8f/M4A1-flattop.png/800px-M4A1-flattop.png" },
            { name: "Uzi", image: "https://www.daileisure.co.uk/image/cache/catalog/Umarex/iwi/iwi-mini-uzi-co2-1-550x550w.jpg" },
            { name: "MP5", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/MP5.jpg/800px-MP5.jpg" },
            { name: "Glock", image: "https://content.osgnetworks.tv/photopacks/a-mostly-complete-history-of-the-glock-17-513089_513090/513091_glock17gen2pistol_hero_1200x800.jpg" },
            { name: "דילדו", image: "https://i.makeup.ie/o/oe/oemyjktpl4go.jpg" }
        ];

        let selectedTeam = [];
        let coins = 100;
        let usedWeapons = [];
        const battles = [
            { name: "כיכר ירושלים", requiredAvg: 65, damage: 10 },
            { name: "פארק המים", requiredAvg: 70, damage: 15 },
            { name: "המרכז", requiredAvg: 75, damage: 20 },
            { name: "שכונת האילנות", requiredAvg: 80, damage: 25 },
            { name: "שכונת סביונים", requiredAvg: 85, damage: 30 },
            { name: "יפה נוף", requiredAvg: 90, damage: 35 },
            { name: "ביג בוס", requiredAvg: 92, damage: 40 }
        ];

        function showIntroPopup() {
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <h2>מעלות תרשיחא בסכנה!</h2>
                <p>גורמים זרים חדרו לעיר ואתה היחיד שיכול לתקן את זה.<br>בעיר זמינים הצוות הבא, בחר 5 אנשים שישתתפו איתך.</p>
                <button onclick="this.parentElement.remove()">התחל</button>
            `;
            document.body.appendChild(popup);
        }

        function displayCharacters() {
            const selectionDiv = document.getElementById("character-selection");
            characters.forEach(char => {
                const card = document.createElement("div");
                card.className = "character-card";
                card.innerHTML = `
                    <img src="${char.image}">
                    <div>${char.name}</div>
                    <select id="role-${char.name}" onchange="updateSelection('${char.name}')">
                        <option value="">בחר תפקיד</option>
                        ${char.name !== "אריאל עין גל" && char.name !== "חיים מרקס" ? '<option value="מנהיג">מנהיג</option>' : ''}
                        <option value="חייל">חייל</option>
                        ${char.name !== "דביר ברקת" ? '<option value="זונה">זונה</option>' : ''}
                        ${char.name === "ליאב בן יעקב" ? '<option value="הגיי של הצוות">הגיי של הצוות</option>' : ''}
                    </select>
                    <select id="weapon-${char.name}" onchange="updateSelection('${char.name}')" disabled>
                        <option value="">בחר נשק</option>
                    </select>
                `;
                card.onclick = () => toggleSelection(char, card);
                selectionDiv.appendChild(card);
            });
            showIntroPopup();
        }

        function toggleSelection(char, card) {
            const role = document.getElementById(`role-${char.name}`).value;
            const weapon = document.getElementById(`weapon-${char.name}`).value;
            const index = selectedTeam.findIndex(c => c.name === char.name);

            if (index !== -1) {
                selectedTeam.splice(index, 1);
                usedWeapons = usedWeapons.filter(w => w !== weapon);
                card.classList.remove("selected");
                document.getElementById(`weapon-${char.name}`).disabled = true;
            } else if (selectedTeam.length < 5 && role && weapon) {
                const leaderCount = selectedTeam.filter(c => c.role === "מנהיג").length;
                const soldierCount = selectedTeam.filter(c => c.role === "חייל").length;
                const whoreCount = selectedTeam.filter(c => c.role === "זונה").length;

                if (role === "מנהיג" && leaderCount >= 1) return alert("יכול להיות רק מנהיג אחד!");
                if (role === "חייל" && soldierCount >= 3) return alert("יכולים להיות עד 3 חיילים!");
                if (role === "זונה" && whoreCount >= 1) return alert("יכולה להיות רק זונה אחת!");
                if (char.name === "דביר ברקת" && role === "זונה") {
                    showLosePopup(char);
                    return;
                }
                if (char.name === "אריאל שרביט" && role !== "חייל" && role !== "זונה") return alert("אריאל שרביט יכולה להיות רק חיילת או זונה!");
                if (char.name === "אריאל שרביט" && weapon !== "Glock") return alert("אריאל שרביט יכולה להשתמש רק ב-Glock!");
                if (char.name === "ליאב בן יעקב" && role !== "הגיי של הצוות") {
                    showLiavConfirmation(char, role, weapon, card);
                    return;
                }

                selectedTeam.push({ ...char, health: char.overall, role, weapon });
                usedWeapons.push(weapon);
                card.classList.add("selected");
            }
            updateWeaponOptions();
            document.getElementById("confirm-team").disabled = selectedTeam.length !== 5;
        }

        function updateSelection(charName) {
            const role = document.getElementById(`role-${charName}`).value;
            const weaponSelect = document.getElementById(`weapon-${charName}`);
            weaponSelect.disabled = !role;

            if (role) {
                weaponSelect.innerHTML = '<option value="">בחר נשק</option>';
                if (role === "זונה") {
                    if (!usedWeapons.includes("דילדו")) weaponSelect.innerHTML += '<option value="דילדו">דילדו</option>';
                } else {
                    weapons.filter(w => w.name !== "דילדו" && (charName !== "אריאל שרביט" || w.name === "Glock")).forEach(w => {
                        if (!usedWeapons.includes(w.name)) weaponSelect.innerHTML += `<option value="${w.name}">${w.name}</option>`;
                    });
                }
            }
        }

        function updateWeaponOptions() {
            characters.forEach(char => {
                const weaponSelect = document.getElementById(`weapon-${char.name}`);
                const role = document.getElementById(`role-${char.name}`).value;
                if (role && !selectedTeam.find(c => c.name === char.name)) {
                    updateSelection(char.name);
                }
            });
        }

        function showLiavConfirmation(char, role, weapon, card) {
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <h3>אתה בטוח שלא רוצה שליאב יהיה הגיי של הצוות?</h3>
                <button onclick="confirmLiav('${char.name}', '${role}', '${weapon}', this.parentElement, true)">כן</button>
                <button onclick="confirmLiav('${char.name}', '${role}', '${weapon}', this.parentElement, false)">לא</button>
            `;
            document.body.appendChild(popup);
        }

        function confirmLiav(charName, role, weapon, popup, confirm) {
            popup.remove();
            const char = characters.find(c => c.name === charName);
            const card = document.querySelector(`#character-selection .character-card:has(#role-${charName})`);
            if (confirm) {
                selectedTeam.push({ ...char, health: char.overall, role, weapon });
                usedWeapons.push(weapon);
                card.classList.add("selected");
            } else {
                document.getElementById(`role-${charName}`).value = "הגיי של הצוות";
                updateSelection(charName);
                document.getElementById(`weapon-${charName}`).value = weapon;
                selectedTeam.push({ ...char, health: char.overall, role: "הגיי של הצוות", weapon });
                usedWeapons.push(weapon);
                card.classList.add("selected");
            }
            updateWeaponOptions();
            document.getElementById("confirm-team").disabled = selectedTeam.length !== 5;
        }

        function showLosePopup(char) {
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <h3>הפסדת!</h3>
                <p>דביר ברקת לא יכול להיות זונה והפרטים שלך נשלחו לדביר ברקת.</p>
                <img src="${char.image}">
            `;
            document.body.appendChild(popup);
        }

        function confirmTeam() {
            selectedTeam.forEach(char => {
                if (char.role === "מנהיג") char.overall += 3;
                if (char.role === "חייל") char.overall += 1;
                if (char.role === "זונה") char.overall -= 2;
                char.health = char.overall; // עדכון החיים ל-Overall המשופר
            });

            document.getElementById("character-selection").style.display = "none";
            document.getElementById("confirm-team").style.display = "none";
            const teamDisplay = document.getElementById("team-display");
            teamDisplay.style.display = "block";
            teamDisplay.innerHTML = "<h2>הצוות שלך:</h2>";

            let delay = 0;
            selectedTeam.forEach(char => {
                const stars = Math.floor(char.overall / 20);
                const card = document.createElement("div");
                card.className = "team-card";
                card.style.animationDelay = `${delay}s`;
                card.innerHTML = `
                    <img src="${char.image}" class="player-img" style="display: none;">
                    <div class="name" style="display: none;">${char.name}</div>
                    <div class="overall" style="display: none;">${char.role} - Overall: ${char.overall}</div>
                    <div class="stars" style="display: none;">${"★".repeat(stars)}</div>
                    <img class="flag" src="${char.flag}" style="display: none;">
                    <img src="${weapons.find(w => w.name === char.weapon).image}" style="width: 80px; display: none;">
                `;
                teamDisplay.appendChild(card);

                setTimeout(() => card.querySelector(".name").style.display = "block", delay * 1000 + 500);
                setTimeout(() => card.querySelector(".player-img").style.display = "block", delay * 1000 + 1000);
                setTimeout(() => card.querySelector(".overall").style.display = "block", delay * 1000 + 1500);
                setTimeout(() => card.querySelector(".stars").style.display = "block", delay * 1000 + 2000);
                setTimeout(() => card.querySelector(".flag").style.display = "block", delay * 1000 + 2500);
                setTimeout(() => card.querySelector("img:last-child").style.display = "block", delay * 1000 + 3000);
                delay += 3;
            });

            setTimeout(() => startBattle(0), delay * 1000 + 1000);
        }

        function startBattle(battleIndex) {
            const battleDisplay = document.getElementById("battle-display");
            battleDisplay.style.display = "block";
            const battle = battles[battleIndex];
            let aliveTeam = selectedTeam.filter(char => char.health > 0);

            if (battleIndex === 2) {
                const traitors = aliveTeam.filter(char => char.name === "ליאב בן יעקב" || char.name === "עמית לסרי");
                if (traitors.length > 0) {
                    traitors.forEach(traitor => {
                        showTraitorPopup(traitor);
                        selectedTeam = selectedTeam.filter(char => char.name !== traitor.name);
                    });
                    setTimeout(() => {
                        document.querySelectorAll(".popup").forEach(popup => popup.remove());
                        displayTeamStatus(battleIndex);
                    }, 3000);
                    return;
                }
            }

            const avg = aliveTeam.reduce((sum, char) => sum + char.overall, 0) / aliveTeam.length || 0;
            battleDisplay.innerHTML = `
                <h2>מלחמה: ${battle.name}</h2>
                <p>דירוג ממוצע נדרש: ${battle.requiredAvg}</p>
                <p>דירוג ממוצע שלך: ${avg.toFixed(2)}</p>
            `;
            
            if (aliveTeam.length === 0) {
                battleDisplay.innerHTML += "<p>הפסדת! כל הצוות שלך מת.</p>";
                return;
            }

            if (avg >= battle.requiredAvg) {
                aliveTeam.forEach(char => {
                    char.health = Math.max(0, char.health - battle.damage);
                });
                displayTeamStatus(battleIndex);
            } else {
                battleDisplay.innerHTML += "<p>הפסדת! הדירוג שלך נמוך מדי.</p>";
            }
        }

        function showTraitorPopup(traitor) {
            traitor.flag = "https://upload.wikimedia.org/wikipedia/commons/thumb/c/ca/Flag_of_Iran.svg/1200px-Flag_of_Iran.svg.png";
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <img src="${traitor.image}">
                <h3>${traitor.name} היה סוכן זר והוא עוזר ליריב!</h3>
                <img src="${traitor.flag}" style="width: 40px;">
            `;
            document.body.appendChild(popup);
        }

        function displayTeamStatus(battleIndex) {
            const battleDisplay = document.getElementById("battle-display");
            battleDisplay.innerHTML = `
                <h2>מלחמה: ${battles[battleIndex].name}</h2>
                <p>דירוג ממוצע נדרש: ${battles[battleIndex].requiredAvg}</p>
                <p>דירוג ממוצע שלך: ${(selectedTeam.filter(char => char.health > 0).reduce((sum, char) => sum + char.overall, 0) / selectedTeam.filter(char => char.health > 0).length || 0).toFixed(2)}</p>
                <p>מטבעות: ${coins}</p>
                <h3>מצב הצוות:</h3>
            `;
            selectedTeam.forEach(char => {
                battleDisplay.innerHTML += `
                    <div>
                        ${char.name} (${char.role}) - חיים: ${char.health}/${char.overall}
                        ${char.health > 0 && char.health < char.overall ? `<button onclick="heal('${char.name}', ${battleIndex})">רפא (10 מטבעות)</button>` : ""}
                    </div>`;
            });
            const aliveTeam = selectedTeam.filter(char => char.health > 0);
            if (aliveTeam.length > 0 && battleIndex < battles.length - 1) {
                battleDisplay.innerHTML += `<button onclick="startBattle(${battleIndex + 1})">המשך לשלב הבא</button>`;
            } else if (aliveTeam.length > 0 && battleIndex === battles.length - 1) {
                battleDisplay.innerHTML += "<p>ניצחת את הביג בוס! סיימת את המשחק!</p>";
            } else {
                battleDisplay.innerHTML += "<p>הפסדת! כל הצוות שלך מת.</p>";
            }
        }

        function heal(charName, battleIndex) {
            if (coins >= 10) {
                const char = selectedTeam.find(c => c.name === charName);
                if (char && char.health > 0 && char.health < char.overall) {
                    char.health = Math.min(char.overall, char.health + 10);
                    coins -= 10;
                    displayTeamStatus(battleIndex);
                }
            } else {
                alert("אין מספיק מטבעות!");
            }
        }

        document.getElementById("confirm-team").onclick = confirmTeam;
        displayCharacters();
    </script>
</body>
</html>
