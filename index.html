<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מלחמת הבלאקיף</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto Mono', monospace;
            background: linear-gradient(135deg, #1a1a1a, #2b0f0f);
            color: #fff;
            direction: rtl;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            animation: bgPulse 10s infinite alternate;
        }

        @keyframes bgPulse {
            0% { background: linear-gradient(135deg, #1a1a1a, #2b0f0f); }
            100% { background: linear-gradient(135deg, #2b0f0f, #1a1a1a); }
        }

        h1 {
            color: #ff1a1a;
            font-size: 3em;
            text-align: center;
            text-shadow: 0 0 10px #ff1a1a;
            margin: 0 0 20px;
        }

        h2 {
            color: #fff;
            font-size: 2em;
            text-shadow: 0 0 5px #00ccff;
            margin: 15px 0;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
        }

        .card {
            background: #2c2c2c;
            border: 2px solid #00ccff;
            border-radius: 8px;
            padding: 10px;
            width: 160px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 204, 255, 0.3);
        }

        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(0, 204, 255, 0.6);
        }

        .card img {
            width: 90px;
            height: 90px;
            border-radius: 5px;
            object-fit: cover;
            margin-bottom: 8px;
        }

        .team-card {
            background: linear-gradient(135deg, #2c2c2c, #3a3a3a);
            border: 2px solid #ff1a1a;
            border-radius: 8px;
            padding: 15px;
            width: 180px;
            text-align: center;
            box-shadow: 0 0 15px rgba(255, 26, 26, 0.3);
        }

        .team-card img {
            width: 100px;
            height: 100px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .stars {
            color: #ffd700;
            margin: 5px 0;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            background: #ff1a1a;
            color: #fff;
            border: 2px solid #00ccff;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 26, 26, 0.5);
            animation: buttonPulse 1.5s infinite;
        }

        @keyframes buttonPulse {
            0% { box-shadow: 0 0 10px rgba(255, 26, 26, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 26, 26, 0.8); }
            100% { box-shadow: 0 0 10px rgba(255, 26, 26, 0.5); }
        }

        button:hover {
            background: #00ccff;
            color: #000;
            transform: scale(1.1);
        }

        button:disabled {
            background: #555;
            border-color: #333;
            box-shadow: none;
            cursor: not-allowed;
            animation: none;
        }

        select {
            padding: 8px;
            font-size: 14px;
            background: #2c2c2c;
            color: #fff;
            border: 1px solid #00ccff;
            border-radius: 5px;
            margin: 5px 0;
            width: 100%;
        }

        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ff1a1a;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 26, 26, 0.5);
            z-index: 1000;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            animation: fadeIn 0.5s ease;
        }

        .chat-popup {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ccff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 204, 255, 0.5);
            z-index: 999;
            width: 300px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .chat-popup img {
            width: 50px;
            height: 50px;
            border-radius: 5px;
            float: right;
            margin-left: 10px;
        }

        .chat-popup p {
            margin: 0;
            font-size: 14px;
            color: #fff;
            text-shadow: 0 0 5px #00ccff;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .popup-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
            text-align: center;
        }

        .battle-screen {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ff1a1a;
            max-width: 1200px;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(255, 26, 26, 0.3);
        }

        .team-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 15px 0;
        }

        .health-bar {
            width: 100%;
            background: #333;
            height: 6px;
            border-radius: 3px;
            margin: 5px 0;
        }

        .health-bar-fill {
            height: 100%;
            background: #ff1a1a;
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        .weapon-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .weapon-card {
            background: #2c2c2c;
            border: 2px solid #00ccff;
            border-radius: 8px;
            padding: 10px;
            width: 140px;
            text-align: center;
            box-shadow: 0 0 10px rgba(0, 204, 255, 0.3);
        }

        .weapon-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 204, 255, 0.6);
        }

        .weapon-card img {
            width: 70px;
            height: 70px;
            border-radius: 5px;
            margin-bottom: 8px;
        }

        .city-image {
            width: 100%;
            max-width: 800px;
            height: auto;
            border-radius: 10px;
            margin: 15px auto;
            display: block;
            box-shadow: 0 0 20px rgba(255, 26, 26, 0.3);
        }

        details {
            margin: 10px 0;
            background: #2c2c2c;
            border: 1px solid #00ccff;
            border-radius: 5px;
            padding: 10px;
        }

        summary {
            cursor: pointer;
            font-size: 1.2em;
            color: #ff1a1a;
            text-shadow: 0 0 5px #ff1a1a;
        }

        details[open] summary {
            color: #fff;
        }

        .submenu {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 10px;
        }

        @media (max-width: 600px) {
            h1 { font-size: 2em; }
            h2 { font-size: 1.5em; }
            .card, .team-card { width: 120px; }
            .card img, .team-card img { width: 70px; height: 70px; }
            button { font-size: 14px; padding: 8px 15px; }
            .popup { padding: 15px; max-width: 90%; }
            .chat-popup { width: 200px; }
            .chat-popup img { width: 40px; height: 40px; }
            .city-image { max-width: 100%; }
        }
    </style>
</head>
<body>
    <h1>מלחמת הבלאקיף</h1>
    <div id="main-menu" class="container"></div>
    <div id="character-selection" class="container" style="display: none;"></div>
    <div id="team-display" class="container" style="display: none;"></div>
    <div id="battle-display" class="battle-screen" style="display: none;"></div>
    <div id="city-management" class="container" style="display: none;"></div>

    <script>
        const weapons = {
            "גלוק": { cost: 1000, bonus: 1, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR-U913muhRYPQf90Rdx6lU2mNovdSLPQTV6A&s" },
            "MP5": { cost: 5000, bonus: 2, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRTcYN7Ay8P0akauOPxiBm9vQ1XTg2fSNOL6w&s" },
            "M16": { cost: 15000, bonus: 3, image: "https://airsoftmania.eu/cdn/shop/products/1152230674_1.webp?v=1662630204" },
            "M4": { cost: 30000, bonus: 4, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8f/M4A1-flattop.png/800px-M4A1-flattop.png" },
            "RPG": { cost: 50000, bonus: 5, image: "https://static.wikia.nocookie.net/maxpayne/images/4/40/Rpg.png" }
        };

        const characters = [
            { name: "אור דהן", overall: 79, image: "https://i.postimg.cc/13r31pJG/IMG-5054.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((79 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 75, defense: 70, fatPercentage: 18, report: "ביצועים סבירים", weapon: "גלוק", trained: false },
            { name: "יוסף קחלר", overall: 88, image: "https://i.postimg.cc/KYcvGRHd/IMG-4721-2.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Flag_of_Iraq.svg/1200px-Flag_of_Iraq.svg.png", value: Math.round(80000 + ((88 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 90, defense: 85, fatPercentage: 12, report: "לוחם מצוין", weapon: "גלוק", trained: false },
            { name: "עמית לסרי", overall: 90, image: "https://i.postimg.cc/Y2T962vW/IMG-5056.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((90 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 92, defense: 88, fatPercentage: 10, report: "כישרון טבעי", weapon: "גלוק", trained: false },
            { name: "איציק מור יוסף", overall: 82, image: "https://i.postimg.cc/SQnRYYx4/IMG-5057.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((82 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 80, defense: 78, fatPercentage: 15, report: "ביצועים טובים", weapon: "גלוק", trained: false },
            { name: "איתי אוחנה", overall: 90, image: "https://i.postimg.cc/DwTwNCdf/IMG-5058.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((90 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 93, defense: 87, fatPercentage: 9, report: "חייל עילית", weapon: "גלוק", trained: false },
            { name: "ג׳ורדן בוחבוט", overall: 86, image: "https://i.postimg.cc/zvbsDr5m/IMG-5059.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((86 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 88, defense: 82, fatPercentage: 13, report: "לוחם אמין", weapon: "גלוק", trained: false },
            { name: "דביר אוחנה", overall: 92, image: "https://i.postimg.cc/J0f9G24s/IMG-5060.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((92 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 95, defense: 90, fatPercentage: 8, report: "כוכב עליון", weapon: "גלוק", trained: false },
            { name: "דור אביכזר", overall: 80, image: "https://i.postimg.cc/vBNRdmJL/IMG-5061.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((80 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 78, defense: 75, fatPercentage: 17, report: "ממוצע", weapon: "גלוק", trained: false },
            { name: "יוגב שבתאי", overall: 74, image: "https://i.postimg.cc/TYmPC8bH/IMG-5062.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((74 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 70, defense: 68, fatPercentage: 22, report: "חלש יחסית", weapon: "גלוק", trained: false },
            { name: "ליאב בן יעקב", overall: 83, image: "https://i.postimg.cc/Sss059vx/IMG-5063.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((83 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 82, defense: 80, fatPercentage: 14, report: "ביצועים טובים", weapon: "גלוק", trained: false },
            { name: "אריאל עין גל", overall: 58, image: "https://i.postimg.cc/k5w3fsw-H/IMG-5064.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((58 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 55, defense: 50, fatPercentage: 30, report: "חלש מאוד", weapon: "גלוק", trained: false },
            { name: "מיכה גורלובסקי", overall: 85, image: "https://i.postimg.cc/jjRYHm6N/IMG-5065.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((85 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 87, defense: 83, fatPercentage: 11, report: "לוחם חזק", weapon: "גלוק", trained: false },
            { name: "קורן בן משה", overall: 89, image: "https://i.postimg.cc/wjXdsgNg/IMG-5066.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((89 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 91, defense: 86, fatPercentage: 10, report: "מצוין", weapon: "גלוק", trained: false },
            { name: "נתנאל יוסילביץ׳", overall: 82, image: "https://i.postimg.cc/wMndDBFT/IMG-5068.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((82 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 80, defense: 79, fatPercentage: 16, report: "סביר", weapon: "גלוק", trained: false },
            { name: "חיים מרקס", overall: 66, image: "https://i.postimg.cc/MHnScB7F/IMG-5069.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Flag_of_the_United_States.svg/1200px-Flag_of_the_United_States.svg.png", value: Math.round(80000 + ((66 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 65, defense: 60, fatPercentage: 25, report: "ביצועים נמוכים", weapon: "גלוק", trained: false },
            { name: "רפי אלגרבלי", overall: 71, image: "https://i.postimg.cc/9MFVhKrV/IMG-5070.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Flag_of_Palestine.svg/1200px-Flag_of_Palestine.svg.png", value: Math.round(80000 + ((71 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 68, defense: 66, fatPercentage: 23, report: "חלש", weapon: "גלוק", trained: false },
            { name: "יעקב שוורץ", overall: 88, image: "https://i.postimg.cc/nzRxc2Dm/IMG-5071.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((88 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 89, defense: 85, fatPercentage: 12, report: "לוחם מעולה", weapon: "גלוק", trained: false },
            { name: "אריאל שרביט", overall: 57, image: "https://i.postimg.cc/TPcGBf2C/IMG-5072.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: 80000, attack: 50, defense: 45, fatPercentage: 32, report: "חלשה ביותר", weapon: "גלוק", trained: false },
            { name: "דביר ברקת", overall: 96, image: "https://www.qube.co.il/images/ency/bands/DvirBareket.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: 36000000, attack: 99, defense: 98, fatPercentage: 5, report: "מושלם", weapon: "גלוק", trained: false }
        ];

        let selectedTeam = [];
        let coins = 150;
        let teamBudget = 15000000;
        let completedBattles = [];
        let lastBattleName = "";
        let cityBudget = 5000000;
        let cityPopulation = 22000;
        let cityName = "מעלות תרשיחא";
        let cityNeighborhoods = ["יפה נוף", "סביונים", "מרכז העיר", "שכונת רבין", "גבעת הזיתים", "אילנות", "סביונים"];
        let prostitutes = [];
        let buildings = [
            { name: "הבית של ג׳ורדן", value: 4000000, sold: false },
            { name: "הבית של איתי אוחנה", value: 3000000, sold: false },
            { name: "הבית של יוסף קחלר", value: 1500000, sold: false },
            { name: "הבית של יוגב שבתאי", value: 200000, sold: false },
            { name: "הבית של דביר אוחנה", value: 450000, sold: false },
            { name: "היכל התרבות", value: 8000000, sold: false },
            { name: "המרכז המסחרי", value: 12000000, sold: false },
            { name: "בית ספר למוזיקה", value: 5000000, sold: false },
            { name: "אגם מונפורט", value: 10000000, sold: false },
            { name: "קניון צים סנטר", value: 15000000, sold: false },
            { name: "מגדל המים", value: 3000000, sold: false },
            { name: "פארק המים", value: 7000000, sold: false },
            { name: "כיכר ירושלים", value: 2000000, sold: false },
            { name: "כיכר השלום", value: 1500000, sold: false },
            { name: "גינת המשחקים המרכזית", value: 500000, sold: false },
            { name: "פארק העצמאות", value: 800000, sold: false },
            { name: "ספרייה עירונית", value: 1200000, sold: false },
            { name: "בית העם", value: 1000000, sold: false },
            { name: "מגרש הכדורגל העירוני", value: 2500000, sold: false }
        ];
        let cityUpgrades = {
            newNeighborhood: { bought: false, cost: 10000000, population: 4000, income: 40000 },
            airport: { bought: false, cost: 50000000, population: 10000, income: 100000 },
            hotel: { bought: false, cost: 20000000, population: 3000, income: 50000 },
            trainStation: { bought: false, cost: 30000000, population: 5000, income: 60000 },
            busTerminal: { bought: false, cost: 15000000, population: 2000, income: 30000 },
            mall: { bought: false, cost: 25000000, population: 4000, income: 70000 },
            hospital: { bought: false, cost: 40000000, population: 3000, income: 50000 },
            university: { bought: false, cost: 60000000, population: 8000, income: 80000 },
            sportsComplex: { bought: false, cost: 20000000, population: 2000, income: 40000 },
            theater: { bought: false, cost: 15000000, population: 1000, income: 30000 }
        };
        let bigBossDefeated = false;
        let assignedJobs = {};

        const cityImages = [
            { maxPop: 40000, url: "https://www.healthycities.co.il/html5/web/16874/47068ImageFile2.jpg" },
            { maxPop: 80000, url: "https://i.redd.it/10-000-population-for-a-city-this-size-cities-skylines-v0-c0m1gzmdrur81.jpg?width=1920&format=pjpg&auto=webp&s=306d87e5b227ec6b8086401ff747552e2e1c1291" },
            { maxPop: 120000, url: "https://preview.redd.it/10k-population-1-tile-city-economically-stable-v0-s470facgud4c1.png?width=640&crop=smart&auto=webp&s=a0ef6a81edc29911db3372dabcc66715d11ba6b8" },
            { maxPop: 160000, url: "https://preview.redd.it/150-000-population-in-1-tile-no-mods-v0-puls5bpn2cwd1.png?width=1080&crop=smart&auto=webp&s=eb608463d57a0995ba1e70809d397508bfa0f2e0" },
            { maxPop: 250000, url: "https://static-cdn.toi-media.com/www/uploads/2023/06/iStock-1476123691-e1686847822176.jpg" },
            { maxPop: 500000, url: "https://res.cloudinary.com/globes/image/upload/t_800X392/v1740324508/direct/shutterstock_2437057467_dcc9ny.jpg" },
            { maxPop: Infinity, url: "https://img.mako.co.il/2014/12/11/NY_1_i.jpg" }
        ];

        const battles = [
            { name: "כיכר ירושלים", requiredAvg: 65, damage: 10, story: "האויב השתלט על הכיכר המרכזית!" },
            { name: "פארק המים", requiredAvg: 70, damage: 15, story: "חיילי האויב מתחבאים במגלשות!" },
            { name: "המרכז", requiredAvg: 75, damage: 20, story: "המרכז המסחרי נפל!" },
            { name: "שכונת האילנות", requiredAvg: 80, damage: 25, story: "מלכודות הוטמנו בשכונה!" },
            { name: "שכונת סביונים", requiredAvg: 85, damage: 30, story: "האויב בנה בסיס בסביונים!" },
            { name: "יפה נוף", requiredAvg: 90, damage: 35, story: "קרב גובה קטלני!" },
            { name: "ביג בוס", requiredAvg: 92, damage: 40, story: "המנהיג הסופי מחכה!" }
        ];

        const cityJobs = {
            "ראש העיר": 200000,
            "סמנכ״ל": 50000,
            "עובד בזבל": 6000,
            "נהג משאית": 8000,
            "מזכיר/ה": 7000,
            "מנהל בית ספר": 25000,
            "מנהל אבטחה": 10000,
            "שומר בית ספר": 7000,
            "עובד במפעל עטיפית": 5500,
            "עובד בפסקל": 5500,
            "עובד ביילו": 5000,
            "עובד במים": 7000,
            "עובד בחשמל": 7000,
            "מנהל האגם": 20000
        };

        const prostitutesList = ["לאה אוחנה", "אמא של רפי", "זמירה קחלר", "ורד עין גל"];

        const funnyMessages = [
            "אני מרגיש שאני חייב לאונן, אני מאוד מפחד לקרב הבא",
            "אני מרגיש שאני חייב למצוץ או משהו בקטנה כזה למישהו, אני מאוד מפחד מהקרב הבא",
            "אני חייב לדחוף איזה משהו לתחת או שמישהו יזיין אותי רגע בתחת, אני לא יודע אם נצא מהקרב הבא, הייתם החברים הטובים בעולם",
            "אני מרגיש שזה הסוף, בואו תעמדו סביבי ותאוננו, אני ממש לא יודע אם נראה את הבית שוב.."
        ];

        function clearPopups() {
            document.querySelectorAll('.popup, .chat-popup').forEach(popup => popup.remove());
        }

        function showMainMenu() {
            clearPopups();
            const mainMenu = document.getElementById("main-menu");
            mainMenu.style.display = "flex";
            mainMenu.innerHTML = `
                <button onclick="showIntroPopup()">התחל משחק</button>
                ${bigBossDefeated ? `<button onclick="showCityManagement()">ניהול ${cityName}</button>` : ""}
            `;
            hideAllExcept("main-menu");
        }

        function showIntroPopup() {
            clearPopups();
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <div class="popup-content">
                    <h2>מעלות בסכנה!</h2>
                    <p>הצוות שלך ייבחר אוטומטית למלחמה</p>
                    <button onclick="this.parentElement.parentElement.remove(); selectRandomTeam()">המשך</button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        function hideAllExcept(activeId) {
            ["main-menu", "character-selection", "team-display", "battle-display", "city-management"].forEach(id => {
                document.getElementById(id).style.display = id === activeId ? "flex" : "none";
            });
        }

        function displayCharacters() {
            clearPopups();
            const selectionDiv = document.getElementById("character-selection");
            selectionDiv.style.display = "flex";
            selectionDiv.innerHTML = `
                <div style="width: 100%; text-align: center;">
                    <button onclick="selectRandomTeam()">בחר צוות רנדומלי</button>
                </div>
            `;
            hideAllExcept("character-selection");
        }

        function selectRandomTeam() {
            clearPopups();
            selectedTeam = [];
            const shuffled = [...characters].sort(() => 0.5 - Math.random());
            selectedTeam = shuffled.slice(0, 5).map(char => ({ ...char, health: char.overall }));
            assignRandomRoles();
            confirmTeam();
        }

        function confirmTeam() {
            clearPopups();
            const teamDisplay = document.getElementById("team-display");
            teamDisplay.style.display = "flex";
            teamDisplay.innerHTML = `<h2>הצוות שלך:</h2>`;
            selectedTeam.forEach(char => {
                const stars = Math.round(char.overall / 20);
                const card = document.createElement("div");
                card.className = "team-card";
                card.innerHTML = `
                    <img src="${char.image}" alt="${char.name}">
                    <div>${char.name}</div>
                    <div>Overall: ${char.overall}</div>
                    <div class="stars">${"★".repeat(stars)}${"☆".repeat(5 - stars)}</div>
                    <select id="role-${char.name}">
                        <option value="">בחר תפקיד</option>
                        ${char.name !== "אריאל עין גל" && char.name !== "חיים מרקס" ? '<option value="מנהיג">מנהיג</option>' : ''}
                        <option value="חייל">חייל</option>
                        ${char.name !== "דביר ברקת" ? '<option value="זונה">זונה</option>' : ''}
                    </select>
                `;
                teamDisplay.appendChild(card);
            });
            teamDisplay.innerHTML += `
                <div style="width: 100%; text-align: center;">
                    <button onclick="confirmRoles()">אשר תפקידים</button>
                    <button onclick="assignRandomRoles()">בחר תפקידים אוטומטית</button>
                    <button onclick="showMainMenu()">חזור לתפריט ראשי</button>
                </div>
            `;
            hideAllExcept("team-display");
        }

        function assignRandomRoles() {
            let available = [...selectedTeam];
            selectedTeam.forEach(char => char.role = "");
            let leaderCandidates = available.filter(c => c.name !== "אריאל עין גל" && c.name !== "חיים מרקס");
            const leader = leaderCandidates[Math.floor(Math.random() * leaderCandidates.length)];
            leader.role = "מנהיג";
            available = available.filter(c => c.name !== leader.name);
            let whoreCandidates = available.filter(c => c.name !== "דביר ברקת");
            const whore = whoreCandidates[Math.floor(Math.random() * whoreCandidates.length)];
            whore.role = "זונה";
            available = available.filter(c => c.name !== whore.name);
            for (let i = 0; i < Math.min(3, available.length); i++) {
                available[i].role = "חייל";
            }
            confirmRoles();
        }

        function confirmRoles() {
            clearPopups();
            let leaderCount = 0, soldierCount = 0, whoreCount = 0;
            for (const char of selectedTeam) {
                const role = char.role || document.getElementById(`role-${char.name}`).value;
                if (!role) return alert("חובה לבחור תפקיד לכל חבר צוות!");
                if (role === "מנהיג") leaderCount++;
                if (role === "חייל") soldierCount++;
                if (role === "זונה") whoreCount++;
                if (char.name === "דביר ברקת" && role === "זונה") return showLosePopup(char);
                if (char.name === "אריאל שרביט" && role !== "חייל" && role !== "זונה") return alert("אריאל שרביט יכולה להיות רק חיילת או זונה!");
            }
            if (leaderCount > 1) return alert("יכול להיות רק מנהיג אחד!");
            if (soldierCount > 3) return alert("יכולים להיות עד 3 חיילים!");
            if (whoreCount > 1) return alert("יכולה להיות רק זונה אחת!");

            selectedTeam.forEach(char => {
                const role = char.role || document.getElementById(`role-${char.name}`).value;
                char.role = role;
                if (role === "מנהיג") char.overall += 3;
                if (role === "חייל") char.overall += 1;
                if (role === "זונה") char.overall -= 2;
                char.health = char.overall;
            });
            startBattle(0);
        }

        function showLosePopup(char) {
            clearPopups();
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <div class="popup-content">
                    <h3>הפסדת!</h3>
                    <p>דביר ברקת לא יכול להיות זונה!</p>
                    <img src="${char.image}" alt="${char.name}">
                    <button onclick="this.parentElement.parentElement.remove(); showMainMenu()">חזור לתפריט ראשי</button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        function startBattle(battleIndex) {
            clearPopups();
            const battleDisplay = document.getElementById("battle-display");
            battleDisplay.style.display = "block";
            const battle = battles[battleIndex];
            battleDisplay.innerHTML = `
                <h2>קרב: ${battle.name}</h2>
                <p>${battle.story}</p>
                <h3>הצוות שלך:</h3>
                <div class="team-grid">
                    ${selectedTeam.map(char => `
                        <div class="team-card">
                            <img src="${char.image}" alt="${char.name}">
                            <div>${char.name}</div>
                            <div>תפקיד: ${char.role}</div>
                            <div>חיים: ${char.health}/${char.overall}</div>
                            <div class="health-bar"><div class="health-bar-fill" style="width: ${(char.health / char.overall) * 100}%"></div></div>
                        </div>
                    `).join('')}
                </div>
                <div style="text-align: center;">
                    <button onclick="fightBattle(${battleIndex})">להילחם!</button>
                    <button onclick="showTeamManagement(${battleIndex})">ניהול צוות</button>
                    <button onclick="showMainMenu()">חזור לתפריט ראשי</button>
                </div>
            `;
            hideAllExcept("battle-display");
            if (Math.random() < 0.2) showFunnyPopup();
        }

        function showFunnyPopup() {
            clearPopups();
            const char = selectedTeam[Math.floor(Math.random() * selectedTeam.length)];
            const message = funnyMessages[Math.floor(Math.random() * funnyMessages.length)];
            const popup = document.createElement("div");
            popup.className = "chat-popup";
            popup.innerHTML = `
                <img src="${char.image}" alt="${char.name}">
                <p>${char.name}: "${message}"</p>
            `;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 5000);
        }

        function fightBattle(battleIndex) {
            clearPopups();
            const battle = battles[battleIndex];
            let aliveTeam = selectedTeam.filter(char => char.health > 0);
            const avg = aliveTeam.reduce((sum, char) => sum + char.overall, 0) / aliveTeam.length || 0;
            lastBattleName = battle.name;

            if (avg >= battle.requiredAvg) {
                aliveTeam.forEach(char => {
                    if (char.weapon !== "RPG") char.health = Math.max(0, char.health - battle.damage);
                });
                if (battleIndex === battles.length - 1) bigBossDefeated = true;
                displayTeamStatus(battleIndex);
            } else {
                const battleDisplay = document.getElementById("battle-display");
                battleDisplay.innerHTML = `
                    <h2>קרב: ${battle.name}</h2>
                    <p>הפסדת! הדירוג שלך נמוך מדי (${avg.toFixed(2)} < ${battle.requiredAvg}).</p>
                    <div style="text-align: center;">
                        <button onclick="showTeamManagement(${battleIndex})">ניהול צוות</button>
                        <button onclick="showMainMenu()">חזור לתפריט ראשי</button>
                    </div>
                `;
            }
        }

        function displayTeamStatus(battleIndex) {
            clearPopups();
            const battleDisplay = document.getElementById("battle-display");
            const aliveTeam = selectedTeam.filter(char => char.health > 0);
            battleDisplay.innerHTML = `
                <h2>מצב הקבוצה - ${battles[battleIndex].name}</h2>
                <p>דירוג ממוצע: ${(aliveTeam.reduce((sum, char) => sum + char.overall, 0) / aliveTeam.length || 0).toFixed(2)}</p>
                <p>מטבעות: ${coins} | תקציב: ${teamBudget.toLocaleString()} €</p>
                <div class="team-grid">
                    ${selectedTeam.map(char => `
                        <div class="team-card">
                            <img src="${char.image}" alt="${char.name}">
                            <div>${char.name} (${char.role})</div>
                            <div>חיים: ${char.health}/${char.overall}</div>
                            <div class="health-bar"><div class="health-bar-fill" style="width: ${(char.health / char.overall) * 100}%"></div></div>
                        </div>
                    `).join('')}
                </div>
                <div style="text-align: center;">
                    <button onclick="${battleIndex < battles.length - 1 ? `startBattle(${battleIndex + 1})` : `showCityManagement()`}">${battleIndex < battles.length - 1 ? "קרב הבא" : "ניהול עיר"}</button>
                    <button onclick="showTransferWindow(${battleIndex})">חלון העברות</button>
                    <button onclick="showTeamManagement(${battleIndex})">ניהול צוות</button>
                    <button onclick="showMainMenu()">חזור לתפריט ראשי</button>
                </div>
            `;
        }

        function showTransferWindow(battleIndex) {
            clearPopups();
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <div class="popup-content">
                    <h2>חלון העברות</h2>
                    <p>תקציב: ${teamBudget.toLocaleString()} €</p>
                    <h3>מכירת שחקנים</h3>
                    <div class="team-grid" id="sell-section"></div>
                    <h3>רכישת שחקנים</h3>
                    <div class="team-grid" id="buy-section"></div>
                    <button onclick="this.parentElement.parentElement.remove(); displayTeamStatus(${battleIndex})">סגור</button>
                </div>
            `;
            document.body.appendChild(popup);

            const sellSection = document.getElementById("sell-section");
            selectedTeam.forEach(char => {
                sellSection.innerHTML += `
                    <div class="team-card">
                        <img src="${char.image}" alt="${char.name}">
                        <div>${char.name}</div>
                        <div>שווי: ${char.value.toLocaleString()} €</div>
                        <button onclick="sellPlayer('${char.name}', ${battleIndex})">מכור</button>
                    </div>`;
            });

            const buySection = document.getElementById("buy-section");
            characters.filter(c => !selectedTeam.some(t => t.name === c.name)).forEach(char => {
                buySection.innerHTML += `
                    <div class="team-card">
                        <img src="${char.image}" alt="${char.name}">
                        <div>${char.name}</div>
                        <div>שווי: ${char.value.toLocaleString()} €</div>
                        <div>Overall: ${char.overall}</div>
                        <button onclick="buyPlayer('${char.name}', ${battleIndex})" ${teamBudget < char.value ? "disabled" : ""}>קנה</button>
                    </div>`;
            });
        }

        function sellPlayer(charName, battleIndex) {
            const char = selectedTeam.find(c => c.name === charName);
            teamBudget += char.value;
            selectedTeam = selectedTeam.filter(c => c.name !== charName);
            document.querySelector(".popup").remove();
            showTransferWindow(battleIndex);
        }

        function buyPlayer(charName, battleIndex) {
            const char = characters.find(c => c.name === charName);
            if (teamBudget >= char.value && selectedTeam.length < 5) {
                teamBudget -= char.value;
                selectedTeam.push({ ...char, health: char.overall });
                document.querySelector(".popup").remove();
                showTransferWindow(battleIndex);
            } else {
                alert(selectedTeam.length >= 5 ? "צוות מלא!" : "אין מספיק תקציב!");
            }
        }

        function showTeamManagement(battleIndex) {
            clearPopups();
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <div class="popup-content">
                    <h2>ניהול צוות</h2>
                    <p>מטבעות: ${coins} | תקציב: ${teamBudget.toLocaleString()} €</p>
                    <h3>אימון וריפוי</h3>
                    <div class="team-grid" id="training-section"></div>
                    <h3>נשקים</h3>
                    <div class="team-grid" id="weapons-section"></div>
                    <div style="text-align: center;">
                        <button onclick="this.parentElement.parentElement.remove(); startBattle(${battleIndex})">חזור לקרב</button>
                        <button onclick="this.parentElement.parentElement.remove(); showMainMenu()">חזור לתפריט ראשי</button>
                    </div>
                </div>
            `;
            document.body.appendChild(popup);

            const trainingSection = document.getElementById("training-section");
            selectedTeam.forEach(char => {
                trainingSection.innerHTML += `
                    <div class="team-card">
                        <img src="${char.image}" alt="${char.name}">
                        <div>${char.name}</div>
                        <div>Overall: ${char.overall}</div>
                        <div>חיים: ${char.health}/${char.overall}</div>
                        <button onclick="trainPlayer('${char.name}', ${battleIndex})" ${char.trained || coins < 5 ? "disabled" : ""}>אמן (5 מטבעות)</button>
                        <button onclick="healPlayer('${char.name}', ${battleIndex})" ${char.health >= char.overall || coins < 10 ? "disabled" : ""}>רפא (10 מטבעות)</button>
                    </div>`;
            });

            const weaponsSection = document.getElementById("weapons-section");
            selectedTeam.forEach(char => {
                weaponsSection.innerHTML += `
                    <div class="team-card">
                        <img src="${char.image}" alt="${char.name}">
                        <div>${char.name}</div>
                        <div>נשק נוכחי: ${char.weapon} (+${weapons[char.weapon].bonus})</div>
                        <button onclick="sellWeapon('${char.name}', ${battleIndex})" ${char.weapon === "גלוק" ? "disabled" : ""}>מכור נשק</button>
                        <button onclick="showWeaponShop('${char.name}', ${battleIndex})">קנה נשק</button>
                    </div>`;
            });
        }

        function showWeaponShop(charName, battleIndex) {
            clearPopups();
            const char = selectedTeam.find(c => c.name === charName);
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <div class="popup-content">
                    <h2>חנות נשקים - ${charName}</h2>
                    <p>תקציב: ${teamBudget.toLocaleString()} €</p>
                    <div class="weapon-grid" id="weapon-options"></div>
                    <button onclick="this.parentElement.parentElement.remove(); showTeamManagement(${battleIndex})">סגור</button>
                </div>
            `;
            document.body.appendChild(popup);

            const weaponOptions = document.getElementById("weapon-options");
            Object.keys(weapons).forEach(weapon => {
                if ((char.name === "אריאל שרביט" && weapon !== "גלוק") || (weapon === "RPG" && char.name !== "דביר ברקת")) return;
                weaponOptions.innerHTML += `
                    <div class="weapon-card">
                        <img src="${weapons[weapon].image}" alt="${weapon}">
                        <div>${weapon}</div>
                        <div>עלות: ${weapons[weapon].cost.toLocaleString()} €</div>
                        <div>בונוס: +${weapons[weapon].bonus}</div>
                        <button onclick="buyWeapon('${charName}', '${weapon}', ${battleIndex})" ${teamBudget < weapons[weapon].cost || char.weapon === weapon ? "disabled" : ""}>קנה</button>
                    </div>`;
            });
        }

        function trainPlayer(charName, battleIndex) {
            const char = selectedTeam.find(c => c.name === charName);
            if (coins >= 5 && !char.trained) {
                coins -= 5;
                char.overall += 3;
                char.health += 3;
                char.trained = true;
                document.querySelector(".popup").remove();
                showTeamManagement(battleIndex);
            }
        }

        function healPlayer(charName, battleIndex) {
            const char = selectedTeam.find(c => c.name === charName);
            if (coins >= 10 && char.health < char.overall) {
                coins -= 10;
                char.health = char.overall;
                document.querySelector(".popup").remove();
                showTeamManagement(battleIndex);
            }
        }

        function buyWeapon(charName, weapon, battleIndex) {
            const char = selectedTeam.find(c => c.name === charName);
            const newWeaponCost = weapons[weapon].cost;
            if (teamBudget >= newWeaponCost) {
                const oldWeaponBonus = weapons[char.weapon].bonus;
                teamBudget -= newWeaponCost;
                char.overall = char.overall - oldWeaponBonus + weapons[weapon].bonus;
                char.health = char.health - oldWeaponBonus + weapons[weapon].bonus;
                char.weapon = weapon;
                document.querySelector(".popup").remove();
                showTeamManagement(battleIndex);
            }
        }

        function sellWeapon(charName, battleIndex) {
            const char = selectedTeam.find(c => c.name === charName);
            if (char.weapon !== "גלוק") {
                const oldWeaponCost = weapons[char.weapon].cost;
                const oldWeaponBonus = weapons[char.weapon].bonus;
                teamBudget += Math.floor(oldWeaponCost / 2);
                char.overall = char.overall - oldWeaponBonus + weapons["גלוק"].bonus;
                char.health = char.health - oldWeaponBonus + weapons["גלוק"].bonus;
                char.weapon = "גלוק";
                document.querySelector(".popup").remove();
                showTeamManagement(battleIndex);
            }
        }

        function getCityImage() {
            return cityImages.find(img => cityPopulation <= img.maxPop).url;
        }

        function showCityManagement() {
            if (!bigBossDefeated) return;
            clearPopups();
            const cityDisplay = document.getElementById("city-management");
            cityDisplay.style.display = "flex";
            cityDisplay.innerHTML = `
                <h2>ניהול ${cityName}</h2>
                <img src="${getCityImage()}" alt="${cityName}" class="city-image">
                <p>תקציב: ${cityBudget.toLocaleString()} ₪ | אוכלוסייה: ${cityPopulation.toLocaleString()}</p>
                <div class="team-grid">
                    <div class="team-card">
                        <h3>שכונות</h3>
                        <p>${cityNeighborhoods.join(', ')}</p>
                        <button onclick="showCityMenu('neighborhoods')">נהל שכונות</button>
                    </div>
                    <div class="team-card">
                        <h3>תפקידים</h3>
                        <p>${Object.keys(assignedJobs).length} תפקידים מאוישים</p>
                        <button onclick="showCityMenu('jobs')">נהל תפקידים</button>
                    </div>
                    <div class="team-card">
                        <h3>שדרוגים ומכירות</h3>
                        <p>${Object.values(cityUpgrades).filter(u => u.bought).length} שדרוגים</p>
                        <button onclick="showCityMenu('upgrades')">נהל שדרוגים ומכירות</button>
                    </div>
                </div>
                <div style="width: 100%; text-align: center;">
                    <button onclick="showMainMenu()">חזור לתפריט ראשי</button>
                </div>
            `;
            hideAllExcept("city-management");
            startCityIncome();
        }

        function startCityIncome() {
            setInterval(() => {
                let jobIncome = Object.keys(assignedJobs).reduce((sum, job) => sum + Math.floor(cityJobs[job] / 10), 0);
                let upgradeIncome = Object.values(cityUpgrades).reduce((sum, u) => sum + (u.bought ? u.income : 0), 0);
                cityBudget += 20 + (prostitutes.length * 30) + upgradeIncome + jobIncome;
                if (Math.random() < 0.02) triggerCityEvent();
                updateCityDisplay();
            }, 5000);
        }

        function updateCityDisplay() {
            const cityDisplay = document.getElementById("city-management");
            if (cityDisplay.style.display === "flex") {
                cityDisplay.innerHTML = `
                    <h2>ניהול ${cityName}</h2>
                    <img src="${getCityImage()}" alt="${cityName}" class="city-image">
                    <p>תקציב: ${cityBudget.toLocaleString()} ₪ | אוכלוסייה: ${cityPopulation.toLocaleString()}</p>
                    <div class="team-grid">
                        <div class="team-card">
                            <h3>שכונות</h3>
                            <p>${cityNeighborhoods.join(', ')}</p>
                            <button onclick="showCityMenu('neighborhoods')">נהל שכונות</button>
                        </div>
                        <div class="team-card">
                            <h3>תפקידים</h3>
                            <p>${Object.keys(assignedJobs).length} תפקידים מאוישים</p>
                            <button onclick="showCityMenu('jobs')">נהל תפקידים</button>
                        </div>
                        <div class="team-card">
                            <h3>שדרוגים ומכירות</h3>
                            <p>${Object.values(cityUpgrades).filter(u => u.bought).length} שדרוגים</p>
                            <button onclick="showCityMenu('upgrades')">נהל שדרוגים ומכירות</button>
                        </div>
                    </div>
                    <div style="width: 100%; text-align: center;">
                        <button onclick="showMainMenu()">חזור לתפריט ראשי</button>
                    </div>
                `;
            }
        }

        function triggerCityEvent() {
            clearPopups();
            const events = [
                { text: "תקלה במים! תיקון עולה 4,000 ₪", cost: 4000 },
                { text: "הצפה בשכונת רבין! תיקון עולה 10,000 ₪", cost: 10000 },
                { text: "שריפה במרכז העיר! תיקון עולה 15,000 ₪", cost: 15000 }
            ];
            const event = events[Math.floor(Math.random() * events.length)];
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <div class="popup-content">
                    <h3>אירוע בעיר!</h3>
                    <p>${event.text}</p>
                    <button onclick="cityBudget -= ${event.cost}; this.parentElement.parentElement.remove(); updateCityDisplay()">תקן (${event.cost.toLocaleString()} ₪)</button>
                    <button onclick="this.parentElement.parentElement.remove()">התעלם</button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        function showCityMenu(section) {
            clearPopups();
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `<div class="popup-content"><h2>ניהול ${cityName}</h2>`;
            if (section === "neighborhoods") {
                popup.innerHTML += `
                    <h3>שכונות</h3>
                    ${cityNeighborhoods.map((n, i) => `<div>${n} <button onclick="changeNeighborhoodName(${i})">שנה שם (1,000,000 ₪)</button></div>`).join('')}
                    <h3>זונות (${prostitutes.length}/4)</h3>
                    <div class="submenu">
                        ${prostitutesList.filter(p => !prostitutes.includes(p)).map(p => `<button onclick="hireProstitute('${p}')">${p} (+30 ₪/5ש)</button>`).join('')}
                    </div>
                `;
            } else if (section === "jobs") {
                popup.innerHTML += `
                    <h3>תפקידים</h3>
                    ${Object.keys(cityJobs).map(job => `
                        <div>
                            ${job}: ${cityJobs[job].toLocaleString()} ₪
                            <span>${assignedJobs[job] ? `(${assignedJobs[job]})` : ''}</span>
                            <button onclick="assignJob('${job}')">בחר עובד</button>
                        </div>
                    `).join('')}
                `;
            } else if (section === "upgrades") {
                popup.innerHTML += `
                    <h3>שדרוגים ומכירות</h3>
                    <details>
                        <summary>מכירת נכסים גדולים</summary>
                        <div class="submenu">
                            ${buildings.filter(b => b.value >= 3000000 && !b.sold).map(b => `<button onclick="sellBuilding('${b.name}')">${b.name} (${b.value.toLocaleString()} ₪)</button>`).join('')}
                        </div>
                    </details>
                    <details>
                        <summary>מכירת נכסים קטנים</summary>
                        <div class="submenu">
                            ${buildings.filter(b => b.value < 3000000 && !b.sold).map(b => `<button onclick="sellBuilding('${b.name}')">${b.name} (${b.value.toLocaleString()} ₪)</button>`).join('')}
                        </div>
                    </details>
                    <details>
                        <summary>שדרוגי עיר</summary>
                        <div class="submenu">
                            <button onclick="buyUpgrade('newNeighborhood')" ${cityUpgrades.newNeighborhood.bought ? "disabled" : ""}>שכונה חדשה (${cityUpgrades.newNeighborhood.cost.toLocaleString()} ₪, +${cityUpgrades.newNeighborhood.population}, +${cityUpgrades.newNeighborhood.income}/5ש)</button>
                            <button onclick="buyUpgrade('airport')" ${cityPopulation < 50000 || cityUpgrades.airport.bought ? "disabled" : ""}>נמל תעופה (${cityUpgrades.airport.cost.toLocaleString()} ₪, +${cityUpgrades.airport.population}, +${cityUpgrades.airport.income}/5ש)</button>
                            <button onclick="buyUpgrade('hotel')" ${cityUpgrades.hotel.bought ? "disabled" : ""}>מלון (${cityUpgrades.hotel.cost.toLocaleString()} ₪, +${cityUpgrades.hotel.population}, +${cityUpgrades.hotel.income}/5ש)</button>
                            <button onclick="buyUpgrade('trainStation')" ${cityUpgrades.trainStation.bought ? "disabled" : ""}>תחנת רכבת (${cityUpgrades.trainStation.cost.toLocaleString()} ₪, +${cityUpgrades.trainStation.population}, +${cityUpgrades.trainStation.income}/5ש)</button>
                            <button onclick="buyUpgrade('busTerminal')" ${cityUpgrades.busTerminal.bought ? "disabled" : ""}>תחנה מרכזית (${cityUpgrades.busTerminal.cost.toLocaleString()} ₪, +${cityUpgrades.busTerminal.population}, +${cityUpgrades.busTerminal.income}/5ש)</button>
                            <button onclick="buyUpgrade('mall')" ${cityUpgrades.mall.bought ? "disabled" : ""}>קניון (${cityUpgrades.mall.cost.toLocaleString()} ₪, +${cityUpgrades.mall.population}, +${cityUpgrades.mall.income}/5ש)</button>
                            <button onclick="buyUpgrade('hospital')" ${cityUpgrades.hospital.bought ? "disabled" : ""}>בית חולים (${cityUpgrades.hospital.cost.toLocaleString()} ₪, +${cityUpgrades.hospital.population}, +${cityUpgrades.hospital.income}/5ש)</button>
                            <button onclick="buyUpgrade('university')" ${cityUpgrades.university.bought ? "disabled" : ""}>אוניברסיטה (${cityUpgrades.university.cost.toLocaleString()} ₪, +${cityUpgrades.university.population}, +${cityUpgrades.university.income}/5ש)</button>
                            <button onclick="buyUpgrade('sportsComplex')" ${cityUpgrades.sportsComplex.bought ? "disabled" : ""}>מתחם ספורט (${cityUpgrades.sportsComplex.cost.toLocaleString()} ₪, +${cityUpgrades.sportsComplex.population}, +${cityUpgrades.sportsComplex.income}/5ש)</button>
                            <button onclick="buyUpgrade('theater')" ${cityUpgrades.theater.bought ? "disabled" : ""}>תיאטרון (${cityUpgrades.theater.cost.toLocaleString()} ₪, +${cityUpgrades.theater.population}, +${cityUpgrades.theater.income}/5ש)</button>
                        </div>
                    </details>
                `;
            }
            popup.innerHTML += `
                <div style="text-align: center;">
                    <button onclick="changeCityName()">שנה שם עיר (3,000,000 ₪)</button>
                    <button onclick="this.parentElement.parentElement.remove()">סגור</button>
                </div>
            </div>`;
            document.body.appendChild(popup);
        }

        function changeCityName() {
            if (cityBudget >= 3000000) {
                const newName = prompt("הזן שם חדש לעיר:");
                if (newName) {
                    cityBudget -= 3000000;
                    cityName = newName;
                    updateCityDisplay();
                    document.querySelector(".popup").remove();
                    showCityMenu('neighborhoods');
                }
            } else {
                alert("אין מספיק תקציב!");
            }
        }

        function changeNeighborhoodName(index) {
            if (cityBudget >= 1000000) {
                const newName = prompt(`הזן שם חדש לשכונה ${cityNeighborhoods[index]}:`);
                if (newName) {
                    cityBudget -= 1000000;
                    cityNeighborhoods[index] = newName;
                    updateCityDisplay();
                    document.querySelector(".popup").remove();
                    showCityMenu('neighborhoods');
                }
            } else {
                alert("אין מספיק תקציב!");
            }
        }

        function hireProstitute(name) {
            if (prostitutes.length < 4) {
                prostitutes.push(name);
                document.querySelector(".popup").remove();
                showCityMenu('neighborhoods');
            } else {
                alert("מגיע עד 4 זונות!");
            }
        }

        function sellBuilding(name) {
            const building = buildings.find(b => b.name === name);
            if (!building.sold) {
                cityBudget += building.value;
                building.sold = true;
                document.querySelector(".popup").remove();
                showCityMenu('upgrades');
            }
        }

        function assignJob(job) {
            clearPopups();
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <div class="popup-content">
                    <h3>בחר עובד ל${job}</h3>
                    <div class="team-grid">
                        ${characters.map(char => `
                            <div class="team-card" onclick="assignJobToPlayer('${job}', '${char.name}')">
                                <img src="${char.image}" alt="${char.name}">
                                <div>${char.name}</div>
                                <div>Overall: ${char.overall}</div>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()">סגור</button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        function assignJobToPlayer(job, charName) {
            assignedJobs[job] = charName;
            document.querySelector(".popup").remove();
            showCityMenu('jobs');
        }

        function buyUpgrade(upgradeName) {
            const upgrade = cityUpgrades[upgradeName];
            if (cityBudget >= upgrade.cost && !upgrade.bought && (upgradeName !== 'airport' || cityPopulation >= 50000)) {
                cityBudget -= upgrade.cost;
                cityPopulation += upgrade.population;
                upgrade.bought = true;
                updateCityDisplay();
                document.querySelector(".popup").remove();
                showCityMenu('upgrades');
            } else {
                alert(upgradeName === 'airport' && cityPopulation < 50000 ? "צריך לפחות 50,000 תושבים!" : "אין מספיק תקציב!");
            }
        }

        showMainMenu();
    </script>
</body>
</html>
