<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מלחמת הבלאקיף</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rubik:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Rubik', sans-serif;
            background: linear-gradient(135deg, #0d1b2a 0%, #1b263b 100%);
            color: #e0e1dd;
            direction: rtl;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAJUlEQVQYV2NkYGD4z8DAwMgABXAG2gQ8ABwFAgB0uJ5aAAAAAElFTkSuQmCC') repeat;
            opacity: 0.05;
            z-index: -1;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            color: #00d4ff;
            font-size: 3em;
            text-align: center;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.7);
            margin: 0 0 20px;
        }

        h2 {
            font-family: 'Orbitron', sans-serif;
            color: #00b4d8;
            font-size: 2em;
            margin: 15px 0;
            text-shadow: 0 0 5px rgba(0, 180, 216, 0.5);
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(27, 38, 59, 0.9);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid #415a77;
        }

        .card {
            background: #1b263b;
            border: 2px solid #415a77;
            border-radius: 8px;
            padding: 15px;
            width: 180px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.3);
            border-color: #00d4ff;
        }

       .card.selected {
    border-color: #00ff85;
    box-shadow: 0 0 15px rgba(0, 255, 133, 0.7);
    background: rgba(0, 255, 133, 0.1);
}
        .card img {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            margin-bottom: 10px;
            border: 1px solid #778da9;
        }

        .war-button {
            padding: 15px 30px;
            font-size: 18px;
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(45deg, #ff1e00, #ff6f61);
            color: #fff;
            border: 2px solid #ff1e00;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 30, 0, 0.6);
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
        }

        .war-button:hover {
            background: linear-gradient(45deg, #ff6f61, #ff1e00);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 30, 0, 0.8);
        }

        .team-card {
            background: #1b263b;
            border: 2px solid #415a77;
            border-radius: 8px;
            padding: 15px;
            width: 200px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .team-card:hover {
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.3);
        }

        .team-card img {
            width: 120px;
            height: 120px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .stars {
            color: #ffd60a;
            margin: 5px 0;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(45deg, #00b4d8, #00d4ff);
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 212, 255, 0.4);
        }

        button:hover {
            background: linear-gradient(45deg, #00d4ff, #00b4d8);
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.6);
        }

        button:disabled {
            background: #415a77;
            color: #778da9;
            cursor: not-allowed;
            box-shadow: none;
        }

        select {
            padding: 10px;
            font-size: 14px;
            background: #1b263b;
            color: #e0e1dd;
            border: 1px solid #415a77;
            border-radius: 6px;
            margin: 5px 0;
            width: 100%;
        }

        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(27, 38, 59, 0.95);
            border: 2px solid #00d4ff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .chat-popup {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #1b263b;
            border: 2px solid #00d4ff;
            color: #e0e1dd;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 999;
            width: 280px;
        }

        .chat-popup img {
            width: 50px;
            height: 50px;
            border-radius: 6px;
            float: right;
            margin-left: 10px;
        }

        .battle-screen {
            background: rgba(27, 38, 59, 0.9);
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #415a77;
            max-width: 1200px;
            margin: 20px auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .team-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .health-bar {
            width: 100%;
            background: #415a77;
            height: 8px;
            border-radius: 4px;
            margin: 5px 0;
        }

        .health-bar-fill {
            height: 100%;
            background: #00ff85;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .weapon-grid, .army-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .weapon-card, .army-card {
            background: #1b263b;
            border: 2px solid #415a77;
            border-radius: 8px;
            padding: 15px;
            width: 160px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .weapon-card:hover, .army-card:hover {
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.3);
        }

        .weapon-card img, .army-card img {
            width: 80px;
            height: 80px;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .city-image {
            width: 100%;
            max-width: 700px;
            height: auto;
            border-radius: 12px;
            margin: 20px auto;
            display: block;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid #00d4ff;
        }

        .upgrade-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #1b263b;
            border: 2px solid #415a77;
        }

        .upgrade-table th, .upgrade-table td {
            border: 1px solid #415a77;
            padding: 12px;
            text-align: center;
        }

        .upgrade-table th {
            background: #00b4d8;
            color: #fff;
            font-family: 'Orbitron', sans-serif;
        }

        .upgrade-table td {
            background: #1b263b;
            color: #e0e1dd;
        }

        details {
            margin: 15px 0;
            background: #1b263b;
            border: 2px solid #415a77;
            border-radius: 8px;
            padding: 15px;
        }

        summary {
            cursor: pointer;
            font-size: 1.3em;
            color: #00搜索引擎优化ff;
            font-family: 'Orbitron', sans-serif;
        }

        details[open] summary {
            color: #e0e1dd;
        }

        .submenu {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 15px;
        }

        .army-unit-card {
            background: #1b263b;
            border: 2px solid #415a77;
            border-radius: 8px;
            padding: 15px;
            width: 180px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .army-unit-card:hover {
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.3);
        }

        .army-unit-card img {
            width: 100px;
            height: 100px;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        @media (max-width: 600px) {
            h1 { font-size: 2.2em; }
            h2 { font-size: 1.6em; }
            .card, .team-card { width: 140px; }
            .card img { width: 80px; height: 80px; }
            .team-card img { width: 100px; height: 100px; }
            button { font-size: 14px; padding: 10px 18px; }
            .popup { padding: 20px; max-width: 95%; }
            .chat-popup { width: 220px; }
            .chat-popup img { width: 40px; height: 40px; }
            .city-image { max-width: 100%; }
        }
 
        .city-dashboard {
    background: rgba(27, 38, 59, 0.95);
    padding: 20px;
    border-radius: 15px;
    border: 2px solid #00d4ff;
    max-width: 1400px;
    margin: 20px auto;
    box-shadow: 0 6px 25px rgba(0, 212, 255, 0.2);
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 20px;
}

.stats-panel {
    background: #1b263b;
    padding: 15px;
    border-radius: 10px;
    border: 1px solid #415a77;
}

.stats-panel h3 {
    color: #00ff85;
    margin-bottom: 10px;
}

.stats-bar {
    width: 100%;
    height: 10px;
    background: #415a77;
    border-radius: 5px;
    margin: 5px 0;
}

.stats-bar-fill {
    height: 100%;
    border-radius: 5px;
    transition: width 1s ease;
}

.stats-bar-fill.population { background: #00ff85; }
.stats-bar-fill.budget { background: #ffd60a; }
.stats-bar-fill.army { background: #ff6f61; }

.city-map {
    background: #0d1b2a;
    border-radius: 10px;
    padding: 15px;
    position: relative;
    height: 400px;
    overflow: hidden;
}

.map-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('https://i.imgur.com/8zX9K5M.png') no-repeat center;
    background-size: cover;
    opacity: 0.3;
}

.map-item {
    position: absolute;
    background: rgba(0, 212, 255, 0.7);
    border-radius: 50%;
    width: 20px;
    height: 20px;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.map-item:hover {
    transform: scale(1.5);
}

.control-panel {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.control-card {
    background: #1b263b;
    padding: 15px;
    border-radius: 10px;
    border: 1px solid #415a77;
    transition: all 0.3s ease;
}

.control-card:hover {
    box-shadow: 0 6px 20px rgba(0, 212, 255, 0.3);
}

.control-card button {
    margin-top: 10px;
}

.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #ff6f61;
    padding: 15px;
    border-radius: 8px;
    color: #fff;
    box-shadow: 0 4px 15px rgba(255, 111, 97, 0.5);
    z-index: 1001;
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateX(50px); }
    to { opacity: 1; transform: translateX(0); }
}
               @keyframes slideIn {
    from { transform: translateY(-50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
    </style>
</head>
<body>
    <h1>מלחמת הבלאקיף</h1>
    <div id="main-menu" class="container"></div>
    <div id="character-selection" class="container" style="display: none;"></div>
    <div id="team-display" class="container" style="display: none;"></div>
    <div id="battle-display" class="battle-screen" style="display: none;"></div>
    <div id="city-management" class="container" style="display: none;"></div>
    <script>
        const weapons = {
            "גלוק": { cost: 1000, bonus: 1, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn9GcR-U913muhRYPQf90Rdx6lU2mNovdSLPQTV6A&s" },
            "MP5": { cost: 5000, bonus: 2, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn9GcRTcYN7Ay8P0akauOPxiBm9vQ1XTg2fSNOL6w&s" },
            "M16": { cost: 15000, bonus: 3, image: "https://airsoftmania.eu/cdn/shop/products/1152230674_1.webp?v=1662630204" },
            "M4": { cost: 30000, bonus: 4, image: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8f/M4A1-flattop.png/800px-M4A1-flattop.png" },
            "RPG": { cost: 50000, bonus: 5, image: "https://static.wikia.nocookie.net/maxpayne/images/4/40/Rpg.png" }
        };

        const characters = [
            { name: "אור דהן", overall: 79, image: "https://i.postimg.cc/13r31pJG/IMG-5054.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((79 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 75, defense: 70, fatPercentage: 18, report: "ביצועים סבירים", weapon: "גלוק", trained: false },
            { name: "יוסף קחלר", overall: 88, image: "https://i.postimg.cc/KYcvGRHd/IMG-4721-2.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Flag_of_Iraq.svg/1200px-Flag_of_Iraq.svg.png", value: Math.round(80000 + ((88 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 90, defense: 85, fatPercentage: 12, report: "לוחם מצוין", weapon: "גלוק", trained: false },
            { name: "עמית לסרי", overall: 90, image: "https://i.postimg.cc/Y2T962vW/IMG-5056.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((90 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 92, defense: 88, fatPercentage: 10, report: "כישרון טבעי", weapon: "גלוק", trained: false },
            { name: "איציק מור יוסף", overall: 82, image: "https://i.postimg.cc/SQnRYYx4/IMG-5057.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((82 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 80, defense: 78, fatPercentage: 15, report: "ביצועים טובים", weapon: "גלוק", trained: false },
            { name: "איתי אוחנה", overall: 90, image: "https://i.postimg.cc/DwTwNCdf/IMG-5058.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((90 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 93, defense: 87, fatPercentage: 9, report: "חייל עילית", weapon: "גלוק", trained: false },
            { name: "ג׳ורדן בוחבוט", overall: 86, image: "https://i.postimg.cc/zvbsDr5m/IMG-5059.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((86 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 88, defense: 82, fatPercentage: 13, report: "לוחם אמין", weapon: "גלוק", trained: false },
            { name: "דביר אוחנה", overall: 92, image: "https://i.postimg.cc/J0f9G24s/IMG-5060.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((92 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 95, defense: 90, fatPercentage: 8, report: "כוכב עליון", weapon: "גלוק", trained: false },
            { name: "דור אביכזר", overall: 80, image: "https://i.postimg.cc/vBNRdmJL/IMG-5061.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((80 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 78, defense: 75, fatPercentage: 17, report: "ממוצע", weapon: "גלוק", trained: false },
            { name: "יוגב שבתאי", overall: 74, image: "https://i.postimg.cc/TYmPC8bH/IMG-5062.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((74 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 70, defense: 68, fatPercentage: 22, report: "חלש יחסית", weapon: "גלוק", trained: false },
            { name: "ליאב בן יעקב", overall: 83, image: "https://i.postimg.cc/Sss059vx/IMG-5063.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((83 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 82, defense: 80, fatPercentage: 14, report: "ביצועים טובים", weapon: "גלוק", trained: false },
            { name: "אריאל עין גל", overall: 58, image: "https://i.postimg.cc/k5w3fsw-H/IMG-5064.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((58 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 55, defense: 50, fatPercentage: 30, report: "חלש מאוד", weapon: "גלוק", trained: false },
            { name: "מיכה גורלובסקי", overall: 85, image: "https://i.postimg.cc/jjRYHm6N/IMG-5065.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((85 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 87, defense: 83, fatPercentage: 11, report: "לוחם חזק", weapon: "גלוק", trained: false },
            { name: "קורן בן משה", overall: 89, image: "https://i.postimg.cc/wjXdsgNg/IMG-5066.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((89 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 91, defense: 86, fatPercentage: 10, report: "מצוין", weapon: "גלוק", trained: false },
            { name: "נתנאל יוסילביץ׳", overall: 82, image: "https://i.postimg.cc/wMndDBFT/IMG-5068.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((82 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 80, defense: 79, fatPercentage: 16, report: "סביר", weapon: "גלוק", trained: false },
            { name: "חיים מרקס", overall: 66, image: "https://i.postimg.cc/MHnScB7F/IMG-5069.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Flag_of_the_United_States.svg/1200px-Flag_of_the_United_States.svg.png", value: Math.round(80000 + ((66 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 65, defense: 60, fatPercentage: 25, report: "ביצועים נמוכים", weapon: "גלוק", trained: false },
            { name: "רפי אלגרבלי", overall: 71, image: "https://i.postimg.cc/9MFVhKrV/IMG-5070.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Flag_of_Palestine.svg/1200px-Flag_of_Palestine.svg.png", value: Math.round(80000 + ((71 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 68, defense: 66, fatPercentage: 23, report: "חלש", weapon: "גלוק", trained: false },
            { name: "יעקב שוורץ", overall: 88, image: "https://i.postimg.cc/nzRxc2Dm/IMG-5071.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: Math.round(80000 + ((88 - 57) / (96 - 57)) * (36000000 - 80000)), attack: 89, defense: 85, fatPercentage: 12, report: "לוחם מעולה", weapon: "גלוק", trained: false },
            { name: "אריאל שרביט", overall: 57, image: "https://i.postimg.cc/TPcGBf2C/IMG-5072.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: 80000, attack: 50, defense: 45, fatPercentage: 32, report: "חלשה ביותר", weapon: "גלוק", trained: false },
            { name: "דביר ברקת", overall: 96, image: "https://www.qube.co.il/images/ency/bands/DvirBareket.jpg", flag: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Flag_of_Israel.svg/1200px-Flag_of_Israel.svg.png", value: 36000000, attack: 99, defense: 98, fatPercentage: 5, report: "מושלם", weapon: "גלוק", trained: false }
        ];

        let selectedTeam = [];
        let coins = 150;
        let teamBudget = 15000000;
        let completedBattles = [];
        let lastBattleName = "";
        let cityBudget = 5000000;
        let cityPopulation = 22000;
        let cityName = "מעלות תרשיחא";
        let cityNeighborhoods = ["יפה נוף", "סביונים", "מרכז העיר", "שכונת רבין", "גבעת הזיתים", "אילנות", "סביונים"];
        let prostitutes = [];
        let buildings = [
            { name: "הבית של ג׳ורדן", value: 4000000, sold: false },
            { name: "הבית של איתי אוחנה", value: 3000000, sold: false },
            { name: "הבית של יוסף קחלר", value: 1500000, sold: false },
            { name: "הבית של יוגב שבתאי", value: 200000, sold: false },
            { name: "הבית של דביר אוחנה", value: 450000, sold: false },
            { name: "היכל התרבות", value: 8000000, sold: false },
            { name: "המרכז המסחרי", value: 12000000, sold: false },
            { name: "בית ספר למוזיקה", value: 5000000, sold: false },
            { name: "אגם מונפורט", value: 10000000, sold: false },
            { name: "קניון צים סנטר", value: 15000000, sold: false },
            { name: "מגדל המים", value: 3000000, sold: false },
            { name: "פארק המים", value: 7000000, sold: false },
            { name: "כיכר ירושלים", value: 2000000, sold: false },
            { name: "כיכר השלום", value: 1500000, sold: false },
            { name: "גינת המשחקים המרכזית", value: 500000, sold: false },
            { name: "פארק העצמאות", value: 800000, sold: false },
            { name: "ספרייה עירונית", value: 1200000, sold: false },
            { name: "בית העם", value: 1000000, sold: false },
            { name: "מגרש הכדורגל העירוני", value: 2500000, sold: false }
        ];
       let cityUpgrades = {
    newNeighborhood: { count: 0, max: 50, cost: 10000000, population: 4000, income: 40000, description: "שכונה חדשה למגורים" },
    apartmentTowers: { count: 0, max: 30, cost: 25000000, population: 10000, income: 80000, description: "מגדלי דירות יוקרתיים" },
    suburbanExpansion: { count: 0, max: 20, cost: 15000000, population: 6000, income: 50000, description: "הרחבת פרברים" },
    airport: { count: 0, max: 3, cost: 50000000, population: 20000, income: 150000, description: "נמל תעופה (דרוש 100,000 תושבים)" },
    hotel: { count: 0, max: 10, cost: 20000000, population: 5000, income: 60000, description: "מלון מפואר" },
    trainStation: { count: 0, max: 5, cost: 30000000, population: 10000, income: 80000, description: "תחנת רכבת מהירה (דרוש 50,000 תושבים)" },
    busTerminal: { count: 0, max: 10, cost: 15000000, population: 3000, income: 35000, description: "תחנה מרכזית" },
    mall: { count: 0, max: 8, cost: 25000000, population: 7000, income: 90000, description: "קניון ענק" },
    hospital: { count: 0, max: 5, cost: 40000000, population: 6000, income: 60000, description: "בית חולים מודרני" },
    university: { count: 0, max: 10, cost: 60000000, population: 15000, income: 100000, description: "אוניברסיטה" },
    sportsComplex: { count: 0, max: 5, cost: 20000000, population: 4000, income: 50000, description: "מתחם ספורט" },
    theater: { count: 0, max: 5, cost: 15000000, population: 2000, income: 40000, description: "תיאטרון" },
    bridge: { count: 0, max: 10, cost: 8000000, population: 1500, income: 30000, description: "גשר" },
    tunnel: { count: 0, max: 8, cost: 12000000, population: 2000, income: 35000, description: "מנהרה" },
    amusementPark: { count: 0, max: 3, cost: 35000000, population: 10000, income: 120000, description: "פארק שעשועים" },
    powerPlant: { count: 0, max: 5, cost: 45000000, population: 4000, income: 70000, description: "תחנת כוח" },
    researchCenter: { count: 0, max: 3, cost: 70000000, population: 20000, income: 150000, description: "מרכז מחקר (דרוש 200,000 תושבים)" },
    seaport: { count: 0, max: 3, cost: 65000000, population: 25000, income: 180000, description: "נמל ימי (דרוש 150,000 תושבים)" },
    skyscraperDistrict: { count: 0, max: 10, cost: 100000000, population: 30000, income: 250000, description: "רובע גורדי שחקים (דרוש 500,000 תושבים)" },
    metroSystem: { count: 0, max: 3, cost: 150000000, population: 40000, income: 300000, description: "רכבת תחתית (דרוש 300,000 תושבים)" },
    spacePort: { bought: false, cost: 500000000, population: 100000, income: 1000000, description: "נמל חלל (דרוש 1,000,000 תושבים)" },
    ecoDistrict: { count: 0, max: 10, cost: 30000000, population: 8000, income: 60000, description: "רובע אקולוגי ירוק" },
    industrialZone: { count: 0, max: 15, cost: 40000000, population: 5000, income: 100000, description: "אזור תעשייה" }
};
        let army = {
            level: 0,
            strength: 0,
            costToBuild: 20000000,
            costToUpgrade: 15000000,
            maxLevel: 5,
            defenseBonus: 0,
            incomeBonus: 0,
            units: {
                police: { count: 0, cost: 500000, strength: 10, income: 2000, image: "https://cdn-icons-png.flaticon.com/512/3063/3063170.png" },
                infantry: { count: 0, cost: 1000000, strength: 20, income: 5000, image: "https://cdn-icons-png.flaticon.com/512/3048/3048428.png" },
                tanks: { count: 0, cost: 5000000, strength: 50, income: 10000, image: "https://cdn-icons-png.flaticon.com/512/3048/3048458.png" }
            }
        };
        let bigBossDefeated = false;
        let assignedJobs = {};

        const cityImages = [
            { maxPop: 40000, url: "https://www.healthycities.co.il/html5/web/16874/47068ImageFile2.jpg" },
            { maxPop: 80000, url: "https://i.redd.it/10-000-population-for-a-city-this-size-cities-skylines-v0-c0m1gzmdrur81.jpg?width=1920&format=pjpg&auto=webp&s=306d87e5b227ec6b8086401ff747552e2e1c1291" },
            { maxPop: 120000, url: "https://preview.redd.it/10k-population-1-tile-city-economically-stable-v0-s470facgud4c1.png?width=640&crop=smart&auto=webp&s=a0ef6a81edc29911db3372dabcc66715d11ba6b8" },
            { maxPop: 160000, url: "https://preview.redd.it/150-000-population-in-1-tile-no-mods-v0-puls5bpn2cwd1.png?width=1080&crop=smart&auto=webp&s=eb608463d57a0995ba1e70809d397508bfa0f2e0" },
            { maxPop: 250000, url: "https://static-cdn.toi-media.com/www/uploads/2023/06/iStock-1476123691-e1686847822176.jpg" },
            { maxPop: 500000, url: "https://res.cloudinary.com/globes/image/upload/t_800X392/v1740324508/direct/shutterstock_2437057467_dcc9ny.jpg" },
            { maxPop: Infinity, url: "https://img.mako.co.il/2014/12/11/NY_1_i.jpg" }
        ];

        const battles = [
            { name: "כיכר ירושלים", requiredAvg: 65, damage: 10, story: "האויב השתלט על הכיכר המרכזית!" },
            { name: "פארק המים", requiredAvg: 70, damage: 15, story: "חיילי האויב מתחבאים במגלשות!" },
            { name: "המרכז", requiredAvg: 75, damage: 20, story: "המרכז המסחרי נפל!" },
            { name: "שכונת האילנות", requiredAvg: 80, damage: 25, story: "מלכודות הוטמנו בשכונה!" },
            { name: "שכונת סביונים", requiredAvg: 85, damage: 30, story: "האויב בנה בסיס בסביונים!" },
            { name: "יפה נוף", requiredAvg: 90, damage: 35, story: "קרב גובה קטלני!" },
            { name: "ביג בוס", requiredAvg: 92, damage: 40, story: "המנהיג הסופי מחכה!" }
        ];

        const cityJobs = {
            "ראש העיר": 200000,
            "סמנכ״ל": 50000,
            "עובד בזבל": 6000,
            "נהג משאית": 8000,
            "מזכיר/ה": 7000,
            "מנהל בית ספר": 25000,
            "מנהל אבטחה": 10000,
            "שומר בית ספר": 7000,
            "עובד במפעל עטיפית": 5500,
            "עובד בפסקל": 5500,
            "עובד ביילו": 5000,
            "עובד במים": 7000,
            "עובד בחשמל": 7000,
            "מנהל האגם": 20000
        };

        const prostitutesList = ["לאה אוחנה", "אמא של רפי", "זמירה קחלר", "ורד עין גל"];

        const funnyMessages = [
            "אני חייב לאונן עכשיו, תכסה אותי!",
            "האויב זרק עליי גרב מסריחה!",
            "מישהו ראה את הסנדוויץ' שלי?",
            "אני עייף, אפשר הפסקת קפה?"
        ];
        function clearPopups() {
            document.querySelectorAll('.popup, .chat-popup').forEach(popup => popup.remove());
        }

        function showMainMenu() {
            clearPopups();
            const mainMenu = document.getElementById("main-menu");
            mainMenu.style.display = "flex";
            mainMenu.innerHTML = `
                <button onclick="showIntroPopup()">התחל משחק</button>
                ${bigBossDefeated ? `<button onclick="showCityManagement()">ניהול ${cityName}</button>` : ""}
            `;
            hideAllExcept("main-menu");
        }

        function showIntroPopup() {
            clearPopups();
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <div class="popup-content">
                    <h2>מעלות בסכנה!</h2>
                    <p>בחר את הצוות שלך למלחמה</p>
                    <button onclick="this.parentElement.parentElement.remove(); displayCharacters()">המשך</button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        function hideAllExcept(activeId) {
            ["main-menu", "character-selection", "team-display", "battle-display", "city-management"].forEach(id => {
                document.getElementById(id).style.display = id === activeId ? "flex" : "none";
            });
        }

      function displayCharacters() {
    clearPopups();
    const selectionDiv = document.getElementById("character-selection");
    selectionDiv.style.display = "flex";
    selectionDiv.innerHTML = `
        <h2>בחר את הצוות שלך (עד 5 לוחמים)</h2>
        <p id="selection-counter">נבחרו: ${selectedTeam.length}/5</p>
    `;
    characters.forEach(char => {
        const card = document.createElement("div");
        card.className = `card ${selectedTeam.some(c => c.name === char.name) ? "selected" : ""}`;
        card.innerHTML = `
            <img src="${char.image}" alt="${char.name}">
            <div>${char.name}</div>
            <div>דירוג: ${char.overall}</div>
        `;
        card.addEventListener("click", () => toggleSelection(char, card));
        selectionDiv.appendChild(card);
    });
    selectionDiv.innerHTML += `
        <div style="width: 100%; text-align: center; margin-top: 20px;">
            <button id="confirm-team" onclick="confirmTeam()" ${selectedTeam.length !== 5 ? "disabled" : ""}>אשר צוות (${selectedTeam.length}/5)</button>
            <button onclick="selectRandomTeam()">בחר צוות רנדומלי</button>
            <button onclick="showMainMenu()">חזור לתפריט ראשי</button>
        </div>
    `;
    hideAllExcept("character-selection");
}
       function toggleSelection(char, card) {
    const index = selectedTeam.findIndex(c => c.name === char.name);
    if (index !== -1) {
        selectedTeam.splice(index, 1);
        card.classList.remove("selected");
    } else if (selectedTeam.length < 5) {
        selectedTeam.push({ ...char, health: char.overall });
        card.classList.add("selected");
    } else {
        alert("כבר בחרת 5 חברי צוות!");
        return;
    }
    const confirmButton = document.getElementById("confirm-team");
    confirmButton.disabled = selectedTeam.length !== 5;
    confirmButton.textContent = `אשר צוות (${selectedTeam.length}/5)`;
    document.getElementById("selection-counter").textContent = `נבחרו: ${selectedTeam.length}/5`;
}

     function selectRandomTeam() {
    clearPopups();
    selectedTeam = [];
    const shuffled = [...characters].sort(() => 0.5 - Math.random());
    selectedTeam = shuffled.slice(0, 5).map(char => ({ ...char, health: char.overall }));
    displayCharacters(); // רענון התצוגה עם הבחירה הרנדומלית
}
       function confirmTeam() {
    clearPopups();
    const popup = document.createElement("div");
    popup.className = "popup";
    popup.innerHTML = `
        <div class="popup-content" style="animation: slideIn 0.5s ease">
            <h2>הצוות שלך נבחר!</h2>
            <p>מוכן להתחיל את הקרב?</p>
            <button onclick="this.parentElement.parentElement.remove(); confirmRoles()">המשך לתפקידים</button>
        </div>
    `;
    document.body.appendChild(popup);
}
        function assignRandomRoles() {
    clearPopups();
    let available = [...selectedTeam];
    selectedTeam.forEach(char => char.role = "");
    let leaderCandidates = available.filter(c => c.name !== "אריאל עין גל" && c.name !== "חיים מרקס");
    const leader = leaderCandidates[Math.floor(Math.random() * leaderCandidates.length)];
    leader.role = "מנהיג";
    document.getElementById(`role-${leader.name}`).value = "מנהיג";
    available = available.filter(c => c.name !== leader.name);
    let whoreCandidates = available.filter(c => c.name !== "דביר ברקת");
    const whore = whoreCandidates[Math.floor(Math.random() * whoreCandidates.length)];
    whore.role = "זונה";
    document.getElementById(`role-${whore.name}`).value = "זונה";
    available = available.filter(c => c.name !== whore.name);
    available.forEach(char => {
        char.role = "חייל";
        document.getElementById(`role-${char.name}`).value = "חייל";
    });
}

        function confirmRoles() {
    clearPopups();
    const teamDisplay = document.getElementById("team-display");
    teamDisplay.style.display = "flex";
    teamDisplay.innerHTML = `<h2>בחר תפקידים לצוות שלך</h2>`;
    selectedTeam.forEach(char => {
        const stars = Math.round(char.overall / 20);
        const card = document.createElement("div");
        card.className = "team-card";
        card.innerHTML = `
            <img src="${char.image}" alt="${char.name}">
            <div>${char.name}</div>
            <div>דירוג: ${char.overall}</div>
            <div class="stars">${"★".repeat(stars)}${"☆".repeat(5 - stars)}</div>
            <select id="role-${char.name}">
                <option value="">בחר תפקיד</option>
                ${char.name !== "אריאל עין גל" && char.name !== "חיים מרקס" ? '<option value="מנהיג">מנהיג</option>' : ''}
                <option value="חייל">חייל</option>
                ${char.name !== "דביר ברקת" ? '<option value="זונה">זונה</option>' : ''}
            </select>
        `;
        teamDisplay.appendChild(card);
    });
    teamDisplay.innerHTML += `
        <div style="width: 100%; text-align: center; margin-top: 20px;">
            <button onclick="assignRolesAndStart()">אשר תפקידים</button>
            <button onclick="assignRandomRoles()">בחר תפקידים אוטומטית</button>
            <button onclick="displayCharacters()">שנה צוות</button>
            <button onclick="showMainMenu()">חזור לתפריט ראשי</button>
        </div>
    `;
    hideAllExcept("team-display");
}

        function showLosePopup(char) {
            clearPopups();
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <div class="popup-content">
                    <h3>הפסדת!</h3>
                    <p>דביר ברקת לא יכול להיות זונה!</p>
                    <img src="${char.image}" alt="${char.name}">
                    <button onclick="this.parentElement.parentElement.remove(); showMainMenu()">חזור לתפריט ראשי</button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        function startBattle(battleIndex) {
            clearPopups();
            const battleDisplay = document.getElementById("battle-display");
            battleDisplay.style.display = "block";
            const battle = battles[battleIndex];
            battleDisplay.innerHTML = `
                <h2>קרב: ${battle.name}</h2>
                <p>${battle.story}</p>
                <h3>הצוות שלך:</h3>
                <div class="team-grid">
                    ${selectedTeam.map(char => `
                        <div class="team-card">
                            <img src="${char.image}" alt="${char.name}">
                            <div>${char.name}</div>
                            <div>תפקיד: ${char.role}</div>
                            <div>חיים: ${char.health}/${char.overall}</div>
                            <div class="health-bar"><div class="health-bar-fill" style="width: ${(char.health / char.overall) * 100}%"></div></div>
                        </div>
                    `).join('')}
                </div>
                <div style="text-align: center;">
                    <button class="war-button" onclick="fightBattle(${battleIndex})">להילחם!</button>
                    <button onclick="showTeamManagement(${battleIndex})">ניהול צוות</button>
                    <button onclick="showMainMenu()">חזור לתפריט ראשי</button>
                </div>
            `;
            hideAllExcept("battle-display");
            if (Math.random() < 0.2) showFunnyPopup();
        }

        function showFunnyPopup() {
            clearPopups();
            const char = selectedTeam[Math.floor(Math.random() * selectedTeam.length)];
            const message = funnyMessages[Math.floor(Math.random() * funnyMessages.length)];
            const popup = document.createElement("div");
            popup.className = "chat-popup";
            popup.innerHTML = `
                <img src="${char.image}" alt="${char.name}">
                <p>${char.name}: "${message}"</p>
            `;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 5000);
        }

        function fightBattle(battleIndex) {
            clearPopups();
            const battle = battles[battleIndex];
            let aliveTeam = selectedTeam.filter(char => char.health > 0);
            const avg = aliveTeam.reduce((sum, char) => sum + char.overall, 0) / aliveTeam.length || 0;
            lastBattleName = battle.name;

            if (avg >= battle.requiredAvg) {
                aliveTeam.forEach(char => {
                    if (char.weapon !== "RPG") char.health = Math.max(0, char.health - battle.damage * (1 - army.defenseBonus / 100));
                });
                if (battleIndex === battles.length - 1) bigBossDefeated = true;
                displayTeamStatus(battleIndex);
            } else {
                const battleDisplay = document.getElementById("battle-display");
                battleDisplay.innerHTML = `
                    <h2>קרב: ${battle.name}</h2>
                    <p>הפסדת! הדירוג שלך נמוך מדי (${avg.toFixed(2)} < ${battle.requiredAvg}).</p>
                    <div style="text-align: center;">
                        <button onclick="showTeamManagement(${battleIndex})">ניהול צוות</button>
                        <button onclick="showMainMenu()">חזור לתפריט ראשי</button>
                    </div>
                `;
            }
        }

        function displayTeamStatus(battleIndex) {
            clearPopups();
            const battleDisplay = document.getElementById("battle-display");
            const aliveTeam = selectedTeam.filter(char => char.health > 0);
            battleDisplay.innerHTML = `
                <h2>מצב הקבוצה - ${battles[battleIndex].name}</h2>
                <p>דירוג ממוצע: ${(aliveTeam.reduce((sum, char) => sum + char.overall, 0) / aliveTeam.length || 0).toFixed(2)}</p>
                <p>מטבעות: ${coins} | תקציב: ${teamBudget.toLocaleString()} €</p>
                <div class="team-grid">
                    ${selectedTeam.map(char => `
                        <div class="team-card">
                            <img src="${char.image}" alt="${char.name}">
                            <div>${char.name} (${char.role})</div>
                            <div>חיים: ${char.health}/${char.overall}</div>
                            <div class="health-bar"><div class="health-bar-fill" style="width: ${(char.health / char.overall) * 100}%"></div></div>
                        </div>
                    `).join('')}
                </div>
                <div style="text-align: center;">
                    <button class="war-button" onclick="${battleIndex < battles.length - 1 ? `startBattle(${battleIndex + 1})` : `showCityManagement()`}">${battleIndex < battles.length - 1 ? "קרב הבא" : "ניהול עיר"}</button>
                    <button onclick="showTransferWindow(${battleIndex})">חלון העברות</button>
                    <button onclick="showTeamManagement(${battleIndex})">ניהול צוות</button>
                    <button onclick="showMainMenu()">חזור לתפריט ראשי</button>
                </div>
            `;
        }

        function showTransferWindow(battleIndex) {
            clearPopups();
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <div class="popup-content">
                    <h2>חלון העברות</h2>
                    <p>תקציב: ${teamBudget.toLocaleString()} €</p>
                    <h3>מכירת שחקנים</h3>
                    <div class="team-grid" id="sell-section"></div>
                    <h3>רכישת שחקנים</h3>
                    <div class="team-grid" id="buy-section"></div>
                    <button onclick="this.parentElement.parentElement.remove(); displayTeamStatus(${battleIndex})">סגור</button>
                </div>
            `;
            document.body.appendChild(popup);

            const sellSection = document.getElementById("sell-section");
            selectedTeam.forEach(char => {
                sellSection.innerHTML += `
                    <div class="team-card">
                        <img src="${char.image}" alt="${char.name}">
                        <div>${char.name}</div>
                        <div>שווי: ${char.value.toLocaleString()} €</div>
                        <button onclick="sellPlayer('${char.name}', ${battleIndex})">מכור</button>
                    </div>`;
            });

            const buySection = document.getElementById("buy-section");
            characters.filter(c => !selectedTeam.some(t => t.name === c.name)).forEach(char => {
                buySection.innerHTML += `
                    <div class="team-card">
                        <img src="${char.image}" alt="${char.name}">
                        <div>${char.name}</div>
                        <div>שווי: ${char.value.toLocaleString()} €</div>
                        <div>Overall: ${char.overall}</div>
                        <button onclick="buyPlayer('${char.name}', ${battleIndex})" ${teamBudget < char.value ? "disabled" : ""}>קנה</button>
                    </div>`;
            });
        }

        function sellPlayer(charName, battleIndex) {
            const char = selectedTeam.find(c => c.name === charName);
            teamBudget += char.value;
            selectedTeam = selectedTeam.filter(c => c.name !== charName);
            document.querySelector(".popup").remove();
            showTransferWindow(battleIndex);
        }

        function buyPlayer(charName, battleIndex) {
            const char = characters.find(c => c.name === charName);
            if (teamBudget >= char.value && selectedTeam.length < 5) {
                teamBudget -= char.value;
                selectedTeam.push({ ...char, health: char.overall });
                document.querySelector(".popup").remove();
                showTransferWindow(battleIndex);
            } else {
                alert(selectedTeam.length >= 5 ? "צוות מלא!" : "אין מספיק תקציב!");
            }
        }

        function showTeamManagement(battleIndex) {
            clearPopups();
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <div class="popup-content">
                    <h2>ניהול צוות</h2>
                    <p>מטבעות: ${coins} | תקציב: ${teamBudget.toLocaleString()} €</p>
                    <h3>אימון וריפוי</h3>
                    <div class="team-grid" id="training-section"></div>
                    <h3>נשקים</h3>
                    <div class="team-grid" id="weapons-section"></div>
                    <div style="text-align: center;">
                        <button onclick="this.parentElement.parentElement.remove(); startBattle(${battleIndex})">חזור לקרב</button>
                        <button onclick="this.parentElement.parentElement.remove(); showMainMenu()">חזור לתפריט ראשי</button>
                    </div>
                </div>
            `;
            document.body.appendChild(popup);

            const trainingSection = document.getElementById("training-section");
            selectedTeam.forEach(char => {
                trainingSection.innerHTML += `
                    <div class="team-card">
                        <img src="${char.image}" alt="${char.name}">
                        <div>${char.name}</div>
                        <div>Overall: ${char.overall}</div>
                        <div>חיים: ${char.health}/${char.overall}</div>
                        <button onclick="trainPlayer('${char.name}', ${battleIndex})" ${char.trained || coins < 5 ? "disabled" : ""}>אמן (5 מטבעות)</button>
                        <button onclick="healPlayer('${char.name}', ${battleIndex})" ${char.health >= char.overall || coins < 10 ? "disabled" : ""}>רפא (10 מטבעות)</button>
                    </div>`;
            });

            const weaponsSection = document.getElementById("weapons-section");
            selectedTeam.forEach(char => {
                weaponsSection.innerHTML += `
                    <div class="team-card">
                        <img src="${char.image}" alt="${char.name}">
                        <div>${char.name}</div>
                        <div>נשק נוכחי: ${char.weapon} (+${weapons[char.weapon].bonus})</div>
                        <button onclick="sellWeapon('${char.name}', ${battleIndex})" ${char.weapon === "גלוק" ? "disabled" : ""}>מכור נשק</button>
                        <button onclick="showWeaponShop('${char.name}', ${battleIndex})">קנה נשק</button>
                    </div>`;
            });
        }

        function showWeaponShop(charName, battleIndex) {
            clearPopups();
            const char = selectedTeam.find(c => c.name === charName);
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <div class="popup-content">
                    <h2>חנות נשקים - ${charName}</h2>
                    <p>תקציב: ${teamBudget.toLocaleString()} €</p>
                    <div class="weapon-grid" id="weapon-options"></div>
                    <button onclick="this.parentElement.parentElement.remove(); showTeamManagement(${battleIndex})">סגור</button>
                </div>
            `;
            document.body.appendChild(popup);

            const weaponOptions = document.getElementById("weapon-options");
            Object.keys(weapons).forEach(weapon => {
                if ((char.name === "אריאל שרביט" && weapon !== "גלוק") || (weapon === "RPG" && char.name !== "דביר ברקת")) return;
                weaponOptions.innerHTML += `
                    <div class="weapon-card">
                        <img src="${weapons[weapon].image}" alt="${weapon}">
                        <div>${weapon}</div>
                        <div>עלות: ${weapons[weapon].cost.toLocaleString()} €</div>
                        <div>בונוס: +${weapons[weapon].bonus}</div>
                        <button onclick="buyWeapon('${charName}', '${weapon}', ${battleIndex})" ${teamBudget < weapons[weapon].cost || char.weapon === weapon ? "disabled" : ""}>קנה</button>
                    </div>`;
            });
        }

        function trainPlayer(charName, battleIndex) {
            const char = selectedTeam.find(c => c.name === charName);
            if (coins >= 5 && !char.trained) {
                coins -= 5;
                char.overall += 3;
                char.health += 3;
                char.trained = true;
                document.querySelector(".popup").remove();
                showTeamManagement(battleIndex);
            }
        }

        function healPlayer(charName, battleIndex) {
            const char = selectedTeam.find(c => c.name === charName);
            if (coins >= 10 && char.health < char.overall) {
                coins -= 10;
                char.health = char.overall;
                document.querySelector(".popup").remove();
                showTeamManagement(battleIndex);
            }
        }

        function buyWeapon(charName, weapon, battleIndex) {
            const char = selectedTeam.find(c => c.name === charName);
            const newWeaponCost = weapons[weapon].cost;
            if (teamBudget >= newWeaponCost) {
                const oldWeaponBonus = weapons[char.weapon].bonus;
                teamBudget -= newWeaponCost;
                char.overall = char.overall - oldWeaponBonus + weapons[weapon].bonus;
                char.health = char.health - oldWeaponBonus + weapons[weapon].bonus;
                char.weapon = weapon;
                document.querySelector(".popup").remove();
                showTeamManagement(battleIndex);
            }
        }

        function sellWeapon(charName, battleIndex) {
            const char = selectedTeam.find(c => c.name === charName);
            if (char.weapon !== "גלוק") {
                const oldWeaponCost = weapons[char.weapon].cost;
                const oldWeaponBonus = weapons[char.weapon].bonus;
                teamBudget += Math.floor(oldWeaponCost / 2);
                char.overall = char.overall - oldWeaponBonus + weapons["גלוק"].bonus;
                char.health = char.health - oldWeaponBonus + weapons["גלוק"].bonus;
                char.weapon = "גלוק";
                document.querySelector(".popup").remove();
                showTeamManagement(battleIndex);
            }
        }

        function getCityImage() {
            return cityImages.find(img => cityPopulation <= img.maxPop).url;
        }

        function showCityManagement() {
    if (!bigBossDefeated) return;
    clearPopups();
    const cityDisplay = document.getElementById("city-management");
    cityDisplay.style.display = "block";
    cityDisplay.className = "city-dashboard";
    cityDisplay.innerHTML = `
        <div class="stats-panel">
            <h3>סטטיסטיקות העיר</h3>
            <p>אוכלוסייה: ${cityPopulation.toLocaleString()}</p>
            <div class="stats-bar"><div class="stats-bar-fill population" style="width: ${Math.min(cityPopulation / 1500000 * 100, 100)}%"></div></div>
            <p>תקציב: ${cityBudget.toLocaleString()} ₪</p>
            <div class="stats-bar"><div class="stats-bar-fill budget" style="width: ${Math.min(cityBudget / 1000000000 * 100, 100)}%"></div></div>
            <p>כוח צבאי: ${army.strength} (רמה ${army.level})</p>
            <div class="stats-bar"><div class="stats-bar-fill army" style="width: ${army.level / army.maxLevel * 100}%"></div></div>
        </div>
        <div class="city-map">
            <div class="map-overlay"></div>
            ${generateMapItems()}
        </div>
        <div class="control-panel">
            <div class="control-card">
                <h3>שכונות וזונות</h3>
                <p>שכונות: ${cityNeighborhoods.length} | זונות: ${prostitutes.length}/4</p>
                <button onclick="showCityMenu('neighborhoods')">נהל</button>
            </div>
            <div class="control-card">
                <h3>תפקידים</h3>
                <p>מאוישים: ${Object.keys(assignedJobs).length}/${Object.keys(cityJobs).length}</p>
                <button onclick="showCityMenu('jobs')">נהל</button>
            </div>
            <div class="control-card">
                <h3>שדרוגים ומכירות</h3>
                <p>שדרוגים: ${Object.values(cityUpgrades).reduce((sum, u) => sum + (u.bought ? 1 : u.count || 0), 0)}</p>
                <button onclick="showCityMenu('upgrades')">נהל</button>
            </div>
            <div class="control-card">
                <h3>צבא</h3>
                <p>רמה ${army.level}/${army.maxLevel} | כוח: ${army.strength}</p>
                <button onclick="showCityMenu('army')">נהל</button>
            </div>
            <button onclick="showMainMenu()">חזור לתפריט ראשי</button>
        </div>
    `;
    hideAllExcept("city-management");
    startCityIncome();
}

        function startCityIncome() {
            setInterval(() => {
                let jobIncome = Object.keys(assignedJobs).length * 10000;
                let upgradeIncome = Object.values(cityUpgrades).reduce((sum, u) => sum + ((u.bought ? u.income : (u.count || 0) * u.income) || 0), 0);
                let armyIncome = army.incomeBonus + Object.values(army.units).reduce((sum, unit) => sum + unit.count * unit.income, 0);
                cityBudget += 20 + (prostitutes.length * 30) + upgradeIncome + jobIncome + armyIncome;
                if (Math.random() < 0.02) triggerCityEvent();
                updateCityDisplay();
            }, 5000);
        }

      function updateCityDisplay() {
    const cityDisplay = document.getElementById("city-management");
    if (cityDisplay.style.display === "flex") {
        cityDisplay.className = "city-dashboard"; // עדכון למחלקה החדשה מהשדרוג
        cityDisplay.innerHTML = `
            <div class="stats-panel">
                <h3>סטטיסטיקות ${cityName}</h3>
                <p>אוכלוסייה: ${cityPopulation.toLocaleString()}</p>
                <div class="stats-bar"><div class="stats-bar-fill population" style="width: ${Math.min(cityPopulation / 1500000 * 100, 100)}%"></div></div>
                <p>תקציב: ${cityBudget.toLocaleString()} ₪</p>
                <div class="stats-bar"><div class="stats-bar-fill budget" style="width: ${Math.min(cityBudget / 1000000000 * 100, 100)}%"></div></div>
                <p>כוח צבאי: ${army.strength} (רמה ${army.level})</p>
                <div class="stats-bar"><div class="stats-bar-fill army" style="width: ${army.level / army.maxLevel * 100}%"></div></div>
            </div>
            <div class="city-map">
                <div class="map-overlay"></div>
                ${generateMapItems()}
            </div>
            <div class="control-panel">
                <div class="control-card">
                    <h3>שכונות וזונות</h3>
                    <p>שכונות: ${cityNeighborhoods.length} | זונות: ${prostitutes.length}/4</p>
                    <button onclick="showCityMenu('neighborhoods')">נהל</button>
                </div>
                <div class="control-card">
                    <h3>תפקידים</h3>
                    <p>מאוישים: ${Object.keys(assignedJobs).length}/${Object.keys(cityJobs).length}</p>
                    <button onclick="showCityMenu('jobs')">נהל</button>
                </div>
                <div class="control-card">
                    <h3>שדרוגים ומכירות</h3>
                    <p>שדרוגים: ${Object.values(cityUpgrades).reduce((sum, u) => sum + (u.bought ? 1 : u.count || 0), 0)}</p>
                    <button onclick="showCityMenu('upgrades')">נהל</button>
                </div>
                <div class="control-card">
                    <h3>צבא</h3>
                    <p>רמה ${army.level}/${army.maxLevel} | כוח: ${army.strength}</p>
                    <button onclick="showCityMenu('army')">נהל</button>
                </div>
                <button onclick="showMainMenu()">חזור לתפריט ראשי</button>
            </div>
        `;
    }
}
        function triggerCityEvent() {
    clearPopups();
    const events = [
        { text: "תקלה במים! תיקון עולה 4,000 ₪", cost: 4000 },
        { text: "הצפה בשכונת רבין! תיקון עולה 10,000 ₪", cost: 10000 },
        { text: "שריפה במרכז העיר! תיקון עולה 15,000 ₪", cost: 15000 },
        { text: "פשיטה על העיר! הפסדת 50,000 ₪", cost: 50000 }
    ];
    const event = events[Math.floor(Math.random() * events.length)];
    const notification = document.createElement("div");
    notification.className = "notification";
    notification.innerHTML = `<p>${event.text}</p>`;
    document.body.appendChild(notification);
    setTimeout(() => notification.remove(), 5000);
    if (event.cost <= cityBudget) {
        cityBudget -= event.cost;
        updateCityDisplay();
    } else {
        const popup = document.createElement("div");
        popup.className = "popup";
        popup.innerHTML = `
            <div class="popup-content">
                <h3>משבר בעיר!</h3>
                <p>${event.text}</p>
                <button onclick="cityBudget -= ${event.cost}; this.parentElement.parentElement.remove(); updateCityDisplay()">תקן (${event.cost.toLocaleString()} ₪)</button>
                <button onclick="cityPopulation -= 1000; this.parentElement.parentElement.remove(); updateCityDisplay()">התעלם (אובדן 1,000 תושבים)</button>
            </div>
        `;
        document.body.appendChild(popup);
    }
}
        function showCityMenu(section) {
            clearPopups();
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `<div class="popup-content"><h2>ניהול ${cityName}</h2>`;
            if (section === "neighborhoods") {
                popup.innerHTML += `
                    <h3>שכונות</h3>
                    ${cityNeighborhoods.map((n, i) => `<div>${n} <button onclick="changeNeighborhoodName(${i})">שנה שם (1,000,000 ₪)</button></div>`).join('')}
                    <h3>זונות (${prostitutes.length}/4)</h3>
                    <div class="submenu">
                        ${prostitutesList.filter(p => !prostitutes.includes(p)).map(p => `<button onclick="hireProstitute('${p}')">${p} (+30 ₪/5ש)</button>`).join('')}
                    </div>
                `;
            } else if (section === "jobs") {
                popup.innerHTML += `
                    <h3>תפקידים</h3>
                    ${Object.keys(cityJobs).map(job => `
                        <div>
                            ${job}: ${cityJobs[job].toLocaleString()} ₪
                            <span>${assignedJobs[job] ? `(${assignedJobs[job]})` : ''}</span>
                            <button onclick="assignJob('${job}')">בחר עובד</button>
                        </div>
                    `).join('')}
                `;
            } else if (section === "upgrades") {
                popup.innerHTML += `
                    <h3>שדרוגים ומכירות</h3>
                    <details>
                        <summary>מכירת נכסים גדולים</summary>
                        <div class="submenu">
                            ${buildings.filter(b => b.value >= 3000000 && !b.sold).map(b => `<button onclick="sellBuilding('${b.name}')">${b.name} (${b.value.toLocaleString()} ₪)</button>`).join('')}
                        </div>
                    </details>
                    <details>
                        <summary>מכירת נכסים קטנים</summary>
                        <div class="submenu">
                            ${buildings.filter(b => b.value < 3000000 && !b.sold).map(b => `<button onclick="sellBuilding('${b.name}')">${b.name} (${b.value.toLocaleString()} ₪)</button>`).join('')}
                        </div>
                    </details>
                    <details open>
                        <summary>שדרוגי עיר</summary>
                        <table class="upgrade-table">
                            <tr>
                                <th>שדרוג</th>
                                <th>עלות (₪)</th>
                                <th>אוכלוסייה</th>
                                <th>הכנסה (/5ש)</th>
                                <th>תיאור</th>
                                <th>פעולה</th>
                            </tr>
                            ${Object.keys(cityUpgrades).map(key => `
                                <tr>
                                    <td>${key === 'newNeighborhood' ? `שכונה חדשה (${cityUpgrades[key].count}/${cityUpgrades[key].max})` : key === 'airport' ? 'נמל תעופה' : key === 'hotel' ? 'מלון' : key === 'trainStation' ? 'תחנת רכבת' : key === 'busTerminal' ? 'תחנה מרכזית' : key === 'mall' ? 'קניון' : key === 'hospital' ? 'בית חולים' : key === 'university' ? `אוניברסיטה (${cityUpgrades[key].count}/${cityUpgrades[key].max})` : key === 'sportsComplex' ? 'מתחם ספורט' : key === 'theater' ? 'תיאטרון' : key === 'bridge' ? 'גשר' : key === 'tunnel' ? 'מנהרה' : key === 'amusementPark' ? 'פארק שעשועים' : key === 'powerPlant' ? 'תחנת כוח' : key === 'researchCenter' ? 'מרכז מחקר' : 'נמל ימי'}</td>
                                    <td>${cityUpgrades[key].cost.toLocaleString()}</td>
                                    <td>+${cityUpgrades[key].population.toLocaleString()}</td>
                                    <td>+${cityUpgrades[key].income.toLocaleString()}</td>
                                    <td>${cityUpgrades[key].description}</td>
                                    <td><button onclick="buyUpgrade('${key}')" ${(cityUpgrades[key].bought || (cityUpgrades[key].count >= cityUpgrades[key].max) || (key === 'airport' && cityPopulation < 50000) || (key === 'seaport' && cityPopulation < 75000) || cityBudget < cityUpgrades[key].cost) ? "disabled" : ""}>קנה</button></td>
                                </tr>
                            `).join('')}
                        </table>
                    </details>
                `;
            } else if (section === "army") {
                popup.innerHTML += `
                    <h3>ניהול צבא</h3>
                    <p>רמה: ${army.level}/${army.maxLevel} | כוח: ${army.strength} | הגנה: ${army.defenseBonus}% | הכנסה: ${army.incomeBonus.toLocaleString()} ₪</p>
                    <button onclick="buildOrUpgradeArmy()" ${army.level >= army.maxLevel || (army.level === 0 && cityBudget < army.costToBuild) || (army.level > 0 && cityBudget < army.costToUpgrade) ? "disabled" : ""}>${army.level === 0 ? `בנה צבא (${army.costToBuild.toLocaleString()} ₪)` : `שדרג צבא (${army.costToUpgrade.toLocaleString()} ₪)`}</button>
                    <div class="army-grid" id="army-units"></div>
                `;
                const armyUnits = document.createElement("div");
                armyUnits.id = "army-units";
                armyUnits.innerHTML = Object.keys(army.units).map(unit => `
                    <div class="army-unit-card">
                        <img src="${army.units[unit].image}" alt="${unit}">
                        <div>${unit === 'police' ? 'משטרה' : unit === 'infantry' ? 'חיילי רגלים' : 'טנקים'}</div>
                        <div>כמות: ${army.units[unit].count}</div>
                        <div>עלות: ${army.units[unit].cost.toLocaleString()} ₪</div>
                        <div>כוח: +${army.units[unit].strength}</div>
                        <div>הכנסה: +${army.units[unit].income.toLocaleString()} ₪</div>
                        <button onclick="recruitUnit('${unit}')" ${cityBudget < army.units[unit].cost || army.level === 0 ? "disabled" : ""}>גייס</button>
                    </div>
                `).join('');
                popup.querySelector(".popup-content").appendChild(armyUnits);
            }
            popup.innerHTML += `
                <div style="text-align: center;">
                    <button onclick="this.parentElement.parentElement.remove(); showCityManagement()">חזור</button>
                </div>
            </div>`;
            document.body.appendChild(popup);
        }

        function changeNeighborhoodName(index) {
            if (cityBudget >= 1000000) {
                const newName = prompt("הזן שם חדש לשכונה:");
                if (newName) {
                    cityBudget -= 1000000;
                    cityNeighborhoods[index] = newName;
                    document.querySelector(".popup").remove();
                    showCityMenu("neighborhoods");
                    updateCityDisplay();
                }
            } else {
                alert("אין מספיק תקציב!");
            }
        }

        function hireProstitute(name) {
            if (prostitutes.length < 4) {
                prostitutes.push(name);
                document.querySelector(".popup").remove();
                showCityMenu("neighborhoods");
                updateCityDisplay();
            } else {
                alert("כבר יש לך 4 זונות!");
            }
        }

        function assignJob(job) {
            clearPopups();
            const popup = document.createElement("div");
            popup.className = "popup";
            popup.innerHTML = `
                <div class="popup-content">
                    <h2>בחר עובד ל-${job}</h2>
                    <div class="team-grid">
                        ${characters.filter(c => !Object.values(assignedJobs).includes(c.name)).map(char => `
                            <div class="team-card">
                                <img src="${char.image}" alt="${char.name}">
                                <div>${char.name}</div>
                                <button onclick="assignJobToCharacter('${job}', '${char.name}')">בחר</button>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="this.parentElement.parentElement.remove(); showCityMenu('jobs')">חזור</button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        function assignJobToCharacter(job, charName) {
            assignedJobs[job] = charName;
            document.querySelector(".popup").remove();
            showCityMenu("jobs");
            updateCityDisplay();
        }

        function sellBuilding(buildingName) {
            const building = buildings.find(b => b.name === buildingName);
            if (building && !building.sold) {
                cityBudget += building.value;
                building.sold = true;
                document.querySelector(".popup").remove();
                showCityMenu("upgrades");
                updateCityDisplay();
            }
        }

      function buyUpgrade(upgradeKey) {
    const upgrade = cityUpgrades[upgradeKey];
    if (cityBudget >= upgrade.cost && (!upgrade.bought || (upgrade.count < upgrade.max))) {
        if ((upgradeKey === "airport" && cityPopulation < 100000) ||
            (upgradeKey === "trainStation" && cityPopulation < 50000) ||
            (upgradeKey === "seaport" && cityPopulation < 150000) ||
            (upgradeKey === "researchCenter" && cityPopulation < 200000) ||
            (upgradeKey === "metroSystem" && cityPopulation < 300000) ||
            (upgradeKey === "skyscraperDistrict" && cityPopulation < 500000) ||
            (upgradeKey === "spacePort" && cityPopulation < 1000000)) {
            alert("אוכלוסייה לא מספיקה!");
            return;
        }
        cityBudget -= upgrade.cost;
        cityPopulation += upgrade.population;
        if ("count" in upgrade) {
            upgrade.count++;
        } else {
            upgrade.bought = true;
        }
        document.querySelector(".popup").remove();
        showCityMenu("upgrades");
        updateCityDisplay();
    } else {
        alert("אין מספיק תקציב או שהשדרוג כבר הגיע למקסימום!");
    }
}

        function buildOrUpgradeArmy() {
            if (army.level === 0 && cityBudget >= army.costToBuild) {
                cityBudget -= army.costToBuild;
                army.level = 1;
                army.defenseBonus = 10;
                army.incomeBonus = 10000;
            } else if (army.level > 0 && army.level < army.maxLevel && cityBudget >= army.costToUpgrade) {
                cityBudget -= army.costToUpgrade;
                army.level++;
                army.defenseBonus += 10;
                army.incomeBonus += 10000;
            }
            document.querySelector(".popup").remove();
            showCityMenu("army");
            updateCityDisplay();
        }
function generateMapItems() {
    const items = [];
    const upgrades = Object.entries(cityUpgrades).filter(([_, u]) => u.bought || u.count > 0);
    upgrades.forEach(([key], i) => {
        const x = Math.random() * 90 + 5;
        const y = Math.random() * 90 + 5;
        items.push(`<div class="map-item" style="left: ${x}%; top: ${y}%;" title="${key}"></div>`);
    });
    return items.join('');
}
        function assignRolesAndStart() {
    clearPopups();
    let leaderCount = 0, soldierCount = 0, whoreCount = 0;
    for (const char of selectedTeam) {
        const role = document.getElementById(`role-${char.name}`).value;
        if (!role) {
            alert("חובה לבחור תפקיד לכל חבר צוות!");
            return;
        }
        if (role === "מנהיג") leaderCount++;
        if (role === "חייל") soldierCount++;
        if (role === "זונה") whoreCount++;
        if (char.name === "דביר ברקת" && role === "זונה") {
            showLosePopup(char);
            return;
        }
        if (char.name === "אריאל שרביט" && role !== "חייל" && role !== "זונה") {
            alert("אריאל שרביט יכולה להיות רק חיילת או זונה!");
            return;
        }
    }
    if (leaderCount > 1) {
        alert("יכול להיות רק מנהיג אחד!");
        return;
    }
    if (soldierCount > 3) {
        alert("יכולים להיות עד 3 חיילים!");
        return;
    }
    if (whoreCount > 1) {
        alert("יכולה להיות רק זונה אחת!");
        return;
    }

    // שמירת התפקידים והתאמת הדירוג
    selectedTeam.forEach(char => {
        const role = document.getElementById(`role-${char.name}`).value;
        char.role = role;
        if (role === "מנהיג") char.overall += 3;
        if (role === "חייל") char.overall += 1;
        if (role === "זונה") char.overall -= 2;
        char.health = char.overall;
    });

    // מעבר לקרב הראשון
    startBattle(0);
}
        function recruitUnit(unit) {
            const unitData = army.units[unit];
            if (cityBudget >= unitData.cost && army.level > 0) {
                cityBudget -= unitData.cost;
                unitData.count++;
                army.strength += unitData.strength;
                document.querySelector(".popup").remove();
                showCityMenu("army");
                updateCityDisplay();
            } else {
                alert(army.level === 0 ? "חובה לבנות צבא קודם!" : "אין מספיק תקציב!");
            }
        }

        // התחלת המשחק
        showMainMenu();
    </script>
</body>
</html>


